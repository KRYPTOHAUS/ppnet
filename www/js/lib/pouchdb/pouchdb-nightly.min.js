!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.PouchDB=e()}}(function(){var define,module,exports;return function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+a+"'")}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return o(n?n:e)},c,c.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(_dereq_,module,exports){"use strict";function arrayFirst(e,t){for(var n=0;n<e.length;n++)if(t(e[n],n)===!0)return e[n];return!1}function yankError(e){return function(t,n){t||n[0].error?call(e,t||n[0]):call(e,null,n[0])}}function computeHeight(e){var t={},n=[];return merge.traverseRevTree(e,function(e,r,o,i){var a=r+"-"+o;return e&&(t[a]=0),void 0!==i&&n.push({from:i,to:a}),a}),n.reverse(),n.forEach(function(e){t[e.from]=void 0===t[e.from]?1+t[e.to]:Math.min(t[e.from],1+t[e.to])}),t}var utils=_dereq_("./utils"),merge=_dereq_("./merge"),errors=_dereq_("./deps/errors"),call=utils.call;module.exports=function(Pouch){return function(opts,callback){function autoCompact(e){return auto_compaction?function(t,n){if(t)call(e,t);else{var r=n.length,o=function(){r--,r||call(e,null,n)};n.forEach(function(e){e.ok?compactDocument(e.id,1,o):o()})}}:e}function compactDocument(e,t,n){customApi._getRevisionTree(e,function(r,o){if(r)return call(n);var i=computeHeight(o),a=[],s=[];Object.keys(i).forEach(function(e){i[e]>t&&a.push(e)}),merge.traverseRevTree(o,function(e,t,n,r,o){var i=t+"-"+n;"available"===o.status&&-1!==a.indexOf(i)&&(o.status="missing",s.push(i))}),customApi._doCompaction(e,o,s,n)})}function processChange(e,t,n){var r=[{rev:e._rev}];"all_docs"===n.style&&(r=merge.collectLeaves(t.rev_tree).map(function(e){return{rev:e.rev}}));var o={id:t.id,changes:r,doc:e};return utils.isDeleted(t,e._rev)&&(o.deleted=!0),n.conflicts&&(o.doc._conflicts=merge.collectConflicts(t),o.doc._conflicts.length||delete o.doc._conflicts),o}var api={},customApi=Pouch.adapters[opts.adapter](opts,function(e,t){if(e)return void(callback&&callback(e));for(var n in api)t.hasOwnProperty(n)||(t[n]=api[n]);opts.name===Pouch.prefix+Pouch.ALL_DBS?callback(e,t):Pouch.open(opts,function(e){callback(e,t)})}),auto_compaction=opts.auto_compaction===!0;api.post=utils.toPromise(function(e,t,n){return"function"==typeof t&&(n=t,t={}),"object"!=typeof e||Array.isArray(e)?call(n,errors.NOT_AN_OBJECT):customApi.bulkDocs({docs:[e]},t,autoCompact(yankError(n)))}),api.put=utils.toPromise(function(){var e,t,n,r,o,i,a=Array.prototype.slice.call(arguments);if(n=a.shift(),"object"!=typeof n||Array.isArray(n))return i=a.pop(),call(i,errors.NOT_AN_OBJECT);for(n=utils.extend(!0,{},n);;)if(e=a.shift(),t=typeof e,"string"!==t||r?"string"===t&&r?n._rev=e:"object"===t?o=e:"function"===t&&(i=e):(n._id=e,r=!0),!a.length)break;return o=o||{},utils.isValidId(n._id)?customApi.bulkDocs({docs:[n]},o,autoCompact(yankError(i))):call(i,errors.MISSING_ID)}),api.putAttachment=utils.toPromise(function(e,t,n,r,o,i){function a(e){e._attachments=e._attachments||{},e._attachments[t]={content_type:o,data:r},api.put(e,i)}return api.taskqueue.ready()?("function"==typeof o&&(i=o,o=r,r=n,n=null),"undefined"==typeof o&&(o=r,r=n,n=null),void api.get(e,function(t,r){return t&&t.error===errors.MISSING_DOC.error?void a({_id:e}):t?void call(i,t):r._rev!==n?void call(i,errors.REV_CONFLICT):void a(r)})):void api.taskqueue.addTask("putAttachment",arguments)}),api.removeAttachment=utils.toPromise(function(e,t,n,r){api.get(e,function(e,o){return e?void call(r,e):o._rev!==n?void call(r,errors.REV_CONFLICT):o._attachments?(delete o._attachments[t],0===Object.keys(o._attachments).length&&delete o._attachments,void api.put(o,r)):call(r,null)})}),api.remove=utils.toPromise(function(e,t,n){"function"==typeof t&&(n=t,t={}),void 0===t&&(t={}),t=utils.extend(!0,{},t),t.was_delete=!0;var r={_id:e._id,_rev:e._rev};return r._deleted=!0,customApi.bulkDocs({docs:[r]},t,yankError(n))}),api.revsDiff=utils.toPromise(function(e,t,n){function r(e,t){s[e]||(s[e]={missing:[]}),s[e].missing.push(t)}function o(t,n){var o=e[t].slice(0);merge.traverseRevTree(n,function(e,n,i,a,s){var u=n+"-"+i,c=o.indexOf(u);-1!==c&&(o.splice(c,1),"available"!==s.status&&r(t,u))}),o.forEach(function(e){r(t,e)})}"function"==typeof t&&(n=t,t={}),t=utils.extend(!0,{},t);var i=Object.keys(e),a=0,s={};i.map(function(t){customApi._getRevisionTree(t,function(r,u){if(r&&"not_found"===r.name&&"missing"===r.message)s[t]={missing:e[t]};else{if(r)return call(n,r);o(t,u)}return++a===i.length?call(n,null,s):void 0})})}),api.compact=utils.toPromise(function(e,t){"function"==typeof e&&(t=e,e={}),api.changes({complete:function(e,n){if(e)return void call(t);var r=n.results.length;return r?void n.results.forEach(function(e){compactDocument(e.id,0,function(){r--,r||call(t)})}):void call(t)}})}),api.get=utils.toPromise(function(e,t,n){function r(){var r=[],i=o.length;return i?void o.forEach(function(o){api.get(e,{rev:o,revs:t.revs,attachments:t.attachments},function(e,t){r.push(e?{missing:o}:{ok:t}),i--,i||call(n,null,r)})}):call(n,null,r)}if(!api.taskqueue.ready())return void api.taskqueue.addTask("get",arguments);if("function"==typeof t&&(n=t,t={}),"string"!=typeof e)return call(n,errors.INVALID_ID);var o=[];if(!t.open_revs)return customApi._get(e,t,function(e,r){if(t=utils.extend(!0,{},t),e)return call(n,e);var o=r.doc,i=r.metadata,a=r.ctx;if(t.conflicts){var s=merge.collectConflicts(i);s.length&&(o._conflicts=s)}if(t.revs||t.revs_info){var u=merge.rootToLeaf(i.rev_tree),c=arrayFirst(u,function(e){return-1!==e.ids.map(function(e){return e.id}).indexOf(o._rev.split("-")[1])});if(c.ids.splice(c.ids.map(function(e){return e.id}).indexOf(o._rev.split("-")[1])+1),c.ids.reverse(),t.revs&&(o._revisions={start:c.pos+c.ids.length-1,ids:c.ids.map(function(e){return e.id})}),t.revs_info){var d=c.pos+c.ids.length;o._revs_info=c.ids.map(function(e){return d--,{rev:d+"-"+e.id,status:e.opts.status}})}}if(t.local_seq&&(o._local_seq=r.metadata.seq),t.attachments&&o._attachments){var l=o._attachments,f=Object.keys(l).length;if(0===f)return call(n,null,o);Object.keys(l).forEach(function(e){customApi._getAttachment(l[e],{encode:!0,ctx:a},function(t,r){o._attachments[e].data=r,--f||call(n,null,o)})})}else{if(o._attachments)for(var p in o._attachments)o._attachments.hasOwnProperty(p)&&(o._attachments[p].stub=!0);call(n,null,o)}});if("all"===t.open_revs)customApi._getRevisionTree(e,function(e,t){e&&(t=[]),o=merge.collectLeaves(t).map(function(e){return e.rev}),r()});else{if(!Array.isArray(t.open_revs))return call(n,errors.error(errors.UNKNOWN_ERROR,"function_clause"));o=t.open_revs;for(var i=0;i<o.length;i++){var a=o[i];if("string"!=typeof a||!/^\d+-/.test(a))return call(n,errors.error(errors.BAD_REQUEST,"Invalid rev format"))}r()}}),api.getAttachment=utils.toPromise(function(e,t,n,r){return api.taskqueue.ready()?(n instanceof Function&&(r=n,n={}),n=utils.extend(!0,{},n),void customApi._get(e,n,function(e,o){return e?call(r,e):o.doc._attachments&&o.doc._attachments[t]?(n.ctx=o.ctx,void customApi._getAttachment(o.doc._attachments[t],n,r)):call(r,errors.MISSING_DOC)})):void api.taskqueue.addTask("getAttachment",arguments)}),api.allDocs=utils.toPromise(function(e,t){if(!api.taskqueue.ready())return void api.taskqueue.addTask("allDocs",arguments);if("function"==typeof e&&(t=e,e={}),e=utils.extend(!0,{},e),"keys"in e){var n=["startkey","endkey","key"].filter(function(t){return t in e})[0];if(n)return void call(t,errors.error(errors.QUERY_PARSE_ERROR,"Query parameter `"+n+"` is not compatible with multi-get"))}return"undefined"==typeof e.skip&&(e.skip=0),customApi._allDocs(e,t)}),api.changes=function(opts){if(!api.taskqueue.ready()){var task=api.taskqueue.addTask("changes",arguments);return{cancel:function(){return task.task?task.task.cancel():(Pouch.DEBUG,void(task.parameters[0].aborted=!0))}}}if(opts=utils.extend(!0,{},opts),opts.processChange=processChange,opts.since||(opts.since=0),"latest"===opts.since){var changes;return api.info(function(e,t){opts.aborted||(opts.since=t.update_seq-1,api.changes(opts))}),{cancel:function(){return changes?changes.cancel():(Pouch.DEBUG,void(opts.aborted=!0))}}}if(opts.filter&&"string"==typeof opts.filter){if("_view"===opts.filter)if(opts.view&&"string"==typeof opts.view){var viewName=opts.view.split("/");api.get("_design/"+viewName[0],function(err,ddoc){if(ddoc&&ddoc.views&&ddoc.views[viewName[1]]){var filter=eval("(function () {  return function (doc) {    var emitted = false;    var emit = function (a, b) {      emitted = true;    };    var view = "+ddoc.views[viewName[1]].map+";    view(doc);    if (emitted) {      return true;    }  }})()");opts.aborted||(opts.filter=filter,api.changes(opts))}else{var msg=ddoc.views?"missing json key: "+viewName[1]:"missing json key: views";err=err||errors.error(errors.MISSING_DOC,msg),utils.call(opts.complete,err)}})}else{var err=errors.error(errors.BAD_REQUEST,"`view` filter parameter is not provided.");utils.call(opts.complete,err)}else{var filterName=opts.filter.split("/");api.get("_design/"+filterName[0],function(err,ddoc){if(ddoc&&ddoc.filters&&ddoc.filters[filterName[1]]){var filter=eval("(function () { return "+ddoc.filters[filterName[1]]+" })()");opts.aborted||(opts.filter=filter,api.changes(opts))}else{var msg=ddoc&&ddoc.filters?"missing json key: "+filterName[1]:"missing json key: filters";err=err||errors.error(errors.MISSING_DOC,msg),utils.call(opts.complete,err)}})}return{cancel:function(){Pouch.DEBUG&&console.log("Cancel Changes Feed"),opts.aborted=!0}}}return"descending"in opts||(opts.descending=!1),opts.limit=0===opts.limit?1:opts.limit,customApi._changes(opts)},api.close=utils.toPromise(function(e){return api.taskqueue.ready()?customApi._close(e):void api.taskqueue.addTask("close",arguments)}),api.info=utils.toPromise(function(e){return api.taskqueue.ready()?customApi._info(e):void api.taskqueue.addTask("info",arguments)}),api.id=function(e){return customApi._id(e)},api.type=function(){return"function"==typeof customApi._type?customApi._type():opts.adapter},api.bulkDocs=utils.toPromise(function(e,t,n){if(!api.taskqueue.ready())return void api.taskqueue.addTask("bulkDocs",arguments);if("function"==typeof t&&(n=t,t={}),t=t?utils.extend(!0,{},t):{},!e||!e.docs)return call(n,errors.MISSING_BULK_DOCS);if(!Array.isArray(e.docs))return call(n,errors.QUERY_PARSE_ERROR);for(var r=0;r<e.docs.length;++r)if("object"!=typeof e.docs[r]||Array.isArray(e.docs[r]))return call(n,errors.NOT_AN_OBJECT);return e=utils.extend(!0,{},e),"new_edits"in t||(t.new_edits=!0),customApi._bulkDocs(e,t,autoCompact(n))});var taskqueue={};taskqueue.ready=!1,taskqueue.queue=[],api.taskqueue={},api.taskqueue.execute=function(e){taskqueue.ready&&taskqueue.queue.forEach(function(t){t.task=e[t.name].apply(null,t.parameters)})},api.taskqueue.ready=function(){return 0===arguments.length?taskqueue.ready:void(taskqueue.ready=arguments[0])},api.taskqueue.addTask=function(e,t){var n={name:e,parameters:t};return taskqueue.queue.push(n),n},api.replicate={},api.replicate.from=function(e,t,n){return"function"==typeof t&&(n=t,t={}),Pouch.replicate(e,customApi,t,n)},api.replicate.to=function(e,t,n){return"function"==typeof t&&(n=t,t={}),Pouch.replicate(customApi,e,t,n)},api.replicate.sync=function(e,t,n){return"function"==typeof t&&(n=t,t={}),Pouch.sync(customApi,e,t,n)};for(var j in api)customApi.hasOwnProperty(j)||(customApi[j]=api[j]);return opts.skipSetup&&(api.taskqueue.ready(!0),api.taskqueue.execute(api)),utils.isCordova()&&cordova.fireWindowEvent(opts.name+"_pouch",{}),customApi}}},{"./deps/errors":8,"./merge":14,"./utils":17}],2:[function(e,t){"use strict";function n(e){for(var t=n.options,r=t.parser[t.strictMode?"strict":"loose"].exec(e),o={},i=14;i--;)o[t.key[i]]=r[i]||"";return o[t.q.name]={},o[t.key[12]].replace(t.q.parser,function(e,n,r){n&&(o[t.q.name][n]=r)}),o}function r(e){return/^_(design|local)/.test(e)?e:encodeURIComponent(e)}function o(e,t){if(/http(s?):/.test(e)){var r=n(e);r.remote=!0,(r.user||r.password)&&(r.auth={username:r.user,password:r.password});var o=r.path.replace(/(^\/|\/$)/g,"").split("/");if(r.db=o.pop(),r.path=o.join("/"),t=t||{},t=u.extend(!0,{},t),r.headers=t.headers||{},t.auth||r.auth){var i=t.auth||r.auth,a=u.btoa(i.username+":"+i.password);r.headers.Authorization="Basic "+a}return t.headers&&(r.headers=t.headers),r}return{host:"",path:"/",db:e,auth:!1}}function i(e,t){if(e.remote){var n=e.path?"/":"";return e.protocol+"://"+e.host+":"+e.port+"/"+e.path+n+e.db+"/"+t}return"/"+e.db+"/"+t}function a(e,t){if(e.remote){var n=e.path?"/":"";return e.protocol+"://"+e.host+":"+e.port+"/"+e.path+n+t}return"/"+t}function s(e,t){function n(e,t){return u.ajax(u.extend({},p,e),t)}function s(e,r,i,a){r=u.extend(!0,{},r);var s=o(a),c={source:d.db,target:s.protocol===d.protocol&&s.authority===d.authority?s.db:s.source};r.continuous&&(c.continuous=!0),r.create_target&&(c.create_target=!0),r.doc_ids&&(c.doc_ids=r.doc_ids),r.filter&&"string"==typeof r.filter&&(c.filter=r.filter),r.query_params&&(c.query_params=r.query_params);var l,f={},p={headers:d.headers,method:"POST",url:d.protocol+"://"+d.host+(80===d.port?"":":"+d.port)+"/_replicate",body:c};i.cancel=function(){this.cancelled=!0,l&&!f.ok&&l.abort(),f._local_id&&(p.body={replication_id:f._local_id}),p.body.cancel=!0,n(p,function(e,n,o){return e?u.call(t,e):void u.call(r.complete,null,f,o)})},i.cancelled||(l=n(p,function(e,n,o){return e?u.call(t,e):(f.ok=!0,n._local_id&&(f._local_id=n._local_id),void u.call(r.complete,null,n,o))}))}var d=o(e.name,e),l=i(d,""),f={},p=e.ajax||{};e=u.extend(!0,{},e);var v={list:[],get:function(e,t){"function"==typeof e&&(t=e,e={count:10});var r=function(e,n){!e&&"uuids"in n?(v.list=v.list.concat(n.uuids),u.call(t,null,"OK")):u.call(t,e||c.UNKNOWN_ERROR)},o="?count="+e.count;n({headers:d.headers,method:"GET",url:a(d,"_uuids")+o},r)}},h=function(){n({headers:d.headers,method:"PUT",url:l},function(e){e&&401===e.status?n({headers:d.headers,method:"HEAD",url:l},function(e){e?u.call(t,e):u.call(t,null,f)}):e&&412!==e.status?u.call(t,e):u.call(t,null,f)})};return e.skipSetup||n({headers:d.headers,method:"GET",url:l},function(e){e?404===e.status?h():u.call(t,e):u.call(t,null,f)}),f.type=function(){return"http"},f.id=function(e){e(i(d,""))},f.request=u.toPromise(function(e,t){return f.taskqueue.ready()?(e.headers=d.headers,e.url=i(d,e.url),void n(e,t)):void f.taskqueue.addTask("request",arguments)}),f.compact=u.toPromise(function(e,t){return f.taskqueue.ready()?("function"==typeof e&&(t=e,e={}),e=u.extend(!0,{},e),void n({headers:d.headers,url:i(d,"_compact"),method:"POST"},function(){function n(){f.info(function(r,o){o.compact_running?setTimeout(n,e.interval||200):u.call(t,null)})}"function"==typeof t&&n()})):void f.taskqueue.addTask("compact",arguments)}),f.info=u.toPromise(function(e){return f.taskqueue.ready()?void n({headers:d.headers,method:"GET",url:i(d,"")},e):void f.taskqueue.addTask("info",arguments)}),f.get=u.toPromise(function(e,t,o){if(!f.taskqueue.ready())return void f.taskqueue.addTask("get",arguments);"function"==typeof t&&(o=t,t={}),t=u.extend(!0,{},t),void 0===t.auto_encode&&(t.auto_encode=!0);var a=[];t.revs&&a.push("revs=true"),t.revs_info&&a.push("revs_info=true"),t.local_seq&&a.push("local_seq=true"),t.open_revs&&("all"!==t.open_revs&&(t.open_revs=JSON.stringify(t.open_revs)),a.push("open_revs="+t.open_revs)),t.attachments&&a.push("attachments=true"),t.rev&&a.push("rev="+t.rev),t.conflicts&&a.push("conflicts="+t.conflicts),a=a.join("&"),a=""===a?"":"?"+a,t.auto_encode&&(e=r(e));var s={headers:d.headers,method:"GET",url:i(d,e+a)},c=e.split("/");(c.length>1&&"_design"!==c[0]&&"_local"!==c[0]||c.length>2&&"_design"===c[0]&&"_local"!==c[0])&&(s.binary=!0),n(s,function(e,t,n){return e?u.call(o,e):void u.call(o,null,t,n)})}),f.remove=u.toPromise(function(e,t,o){return f.taskqueue.ready()?("function"==typeof t&&(o=t,t={}),void n({headers:d.headers,method:"DELETE",url:i(d,r(e._id))+"?rev="+e._rev},o)):void f.taskqueue.addTask("remove",arguments)}),f.getAttachment=u.toPromise(function(e,t,n,o){"function"==typeof n&&(o=n,n={}),n=u.extend(!0,{},n),void 0===n.auto_encode&&(n.auto_encode=!0),n.auto_encode&&(e=r(e)),n.auto_encode=!1,f.get(e+"/"+t,n,o)}),f.removeAttachment=u.toPromise(function(e,t,o,a){return f.taskqueue.ready()?void n({headers:d.headers,method:"DELETE",url:i(d,r(e)+"/"+t)+"?rev="+o},a):void f.taskqueue.addTask("removeAttachment",arguments)}),f.putAttachment=u.toPromise(function(e,t,o,a,s,u){if(!f.taskqueue.ready())return void f.taskqueue.addTask("putAttachment",arguments);"function"==typeof s&&(u=s,s=a,a=o,o=null),"undefined"==typeof s&&(s=a,a=o,o=null);var c=r(e)+"/"+t,l=i(d,c);o&&(l+="?rev="+o);var p={headers:d.headers,method:"PUT",url:l,processData:!1,body:a,timeout:6e4};p.headers["Content-Type"]=s,n(p,u)}),f.put=u.toPromise(function(){var e=Array.prototype.slice.call(arguments);if(!f.taskqueue.ready())return void f.taskqueue.addTask("put",e);var t,o,a,s,l,p;if(a=e.shift(),"object"!=typeof a||Array.isArray(a))return p=e.pop(),u.call(p,c.NOT_AN_OBJECT);for(a=u.extend(!0,{},a);;)if(t=e.shift(),o=typeof t,"string"!==o||s?"string"===o&&s?a._rev=t:"object"===o?l=u.extend(!0,{},t):"function"===o&&(p=t):(a._id=t,s=!0),!e.length)break;if(l=l||{},!u.isValidId(a._id))return u.call(p,c.MISSING_ID);var v=[];l&&"undefined"!=typeof l.new_edits&&v.push("new_edits="+l.new_edits),v=v.join("&"),""!==v&&(v="?"+v),n({headers:d.headers,method:"PUT",url:i(d,r(a._id))+v,body:a},p)}),f.post=u.toPromise(function(e,t,n){return f.taskqueue.ready()?("function"==typeof t&&(n=t,t={}),t=u.extend(!0,{},t),"object"!=typeof e?u.call(n,c.NOT_AN_OBJECT):void("_id"in e?f.put(e,t,n):v.list.length>0?(e._id=v.list.pop(),f.put(e,t,n)):v.get(function(r){return r?u.call(n,c.UNKNOWN_ERROR):(e._id=v.list.pop(),void f.put(e,t,n))}))):void f.taskqueue.addTask("post",arguments)}),f.bulkDocs=u.toPromise(function(e,t,r){if(!f.taskqueue.ready())return void f.taskqueue.addTask("bulkDocs",arguments);if("function"==typeof t&&(r=t,t={}),t||(t={}),!Array.isArray(e.docs))return u.call(r,c.error(c.NOT_AN_OBJECT,"Missing JSON list of 'docs'"));var o=e.docs.filter(function(e){return"object"!=typeof e||Array.isArray(e)});return o.length?u.call(r,c.NOT_AN_OBJECT):(e=u.extend(!0,{},e),t=u.extend(!0,{},t),"undefined"!=typeof t.new_edits&&(e.new_edits=t.new_edits),void n({headers:d.headers,method:"POST",url:i(d,"_bulk_docs"),body:e},r))}),f.allDocs=u.toPromise(function(e,t){if(!f.taskqueue.ready())return void f.taskqueue.addTask("allDocs",arguments);"function"==typeof e&&(t=e,e={}),e=u.extend(!0,{},e);var r,o=[],a="GET";if(e.conflicts&&o.push("conflicts=true"),e.descending&&o.push("descending=true"),e.include_docs&&o.push("include_docs=true"),e.key&&o.push("key="+encodeURIComponent(JSON.stringify(e.key))),e.startkey&&o.push("startkey="+encodeURIComponent(JSON.stringify(e.startkey))),e.endkey&&o.push("endkey="+encodeURIComponent(JSON.stringify(e.endkey))),e.limit&&o.push("limit="+e.limit),"undefined"!=typeof e.skip&&o.push("skip="+e.skip),o=o.join("&"),""!==o&&(o="?"+o),"undefined"!=typeof e.keys){var s=2e3,c="keys="+encodeURIComponent(JSON.stringify(e.keys));c.length+o.length+1<=s?o+=(-1!==o.indexOf("?")?"&":"?")+c:(a="POST",r=JSON.stringify({keys:e.keys}))}n({headers:d.headers,method:a,url:i(d,"_all_docs"+o),body:r},t)}),f.changes=function(e){var t=25;if(!f.taskqueue.ready()){var r=f.taskqueue.addTask("changes",arguments);return{cancel:function(){return r.task?r.task.cancel():void(r.parameters[0].aborted=!0)}}}if(e=u.extend(!0,{},e),e.timeout=e.timeout||0,"latest"===e.since){var o=f.changes({descending:!0,limit:1,timeout:e.timeout,complete:function(t,n){return t?(e.aborted=!0,void u.call(e.complete,t,null)):void(e.aborted||(e.since=n.last_seq,o=f.changes(e)))}});return{cancel:function(){return o?o.cancel():void(e.aborted=!0)}}}var a={},s="undefined"!=typeof e.limit?e.limit:!1;0===s&&(s=1);var l=s;if(e.style&&(a.style=e.style),(e.include_docs||e.filter&&"function"==typeof e.filter)&&(a.include_docs=!0),e.continuous&&(a.feed="longpoll"),e.conflicts&&(a.conflicts=!0),e.descending&&(a.descending=!0),e.filter&&"string"==typeof e.filter&&(a.filter=e.filter,"_view"===e.filter&&e.view&&"string"==typeof e.view&&(a.view=e.view)),e.query_params&&"object"==typeof e.query_params)for(var p in e.query_params)e.query_params.hasOwnProperty(p)&&(a[p]=e.query_params[p]);var v,h,m=function(r,o){a.since=r,e.descending?s&&(a.limit=l):a.limit=!s||l>t?t:l;var u="?"+Object.keys(a).map(function(e){return e+"="+a[e]}).join("&"),c={headers:d.headers,method:"GET",url:i(d,"_changes"+u),timeout:e.timeout};h=r,e.aborted||(v=n(c,o))},y=10,g=0,_={results:[]},b=function(n,r){var o=0;if(r&&r.results){o=r.results.length,_.last_seq=r.last_seq;var i={};i.query=e.query_params,r.results=r.results.filter(function(t){l--;var n=u.filterChange(e)(t);return n&&(_.results.push(t),u.call(e.onChange,t)),n})}else if(n)return e.aborted=!0,void u.call(e.complete,n,null);r&&r.last_seq&&(h=r.last_seq);var a=(r&&r.results.length||0,s&&0>=l||r&&t>o||e.descending);if(e.continuous||!a){n?g+=1:g=0;var d=1<<g,f=y*d,p=e.maximumWait||3e4;if(f>p)return void u.call(e.complete,n||c.UNKNOWN_ERROR,null);setTimeout(function(){m(h,b)},f)}else u.call(e.complete,null,_)};return m(e.since||0,b),{cancel:function(){e.aborted=!0,v.abort()}}},f.revsDiff=u.toPromise(function(e,t,r){return f.taskqueue.ready()?("function"==typeof t&&(r=t,t={}),void n({headers:d.headers,method:"POST",url:i(d,"_revs_diff"),body:e},function(e,t){u.call(r,e,t)})):void f.taskqueue.addTask("revsDiff",arguments)}),f.close=u.toPromise(function(e){return f.taskqueue.ready()?void u.call(e,null):void f.taskqueue.addTask("close",arguments)}),f.replicateOnServer=function(e,t,n){return f.taskqueue.ready()?void e.id(function(r){s(e,t,n,r)}):(f.taskqueue.addTask("replicateOnServer",arguments),n)},f}var u=e("../utils"),c=e("../deps/errors");n.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},s.destroy=u.toPromise(function(e,t,n){var r=o(e,t);t=t||{},"function"==typeof t&&(n=t,t={}),t=u.extend(!0,{},t),t.headers=r.headers,t.method="DELETE",t.url=i(r,""),u.ajax(t,n)}),s.valid=function(){return!0},t.exports=s},{"../deps/errors":8,"../utils":17}],3:[function(e,t){(function(n){"use strict";function r(e){return function(t){a.call(e,u.error(u.IDB_ERROR,t.target,t.type))}}function o(){var e="_pouch__checkModernIdb_"+(n.navigator&&n.navigator.appVersion),t=n.localStorage&&n.localStorage[e];if(t)return JSON.parse(t);var r="_pouch__checkModernIdb",o=null===n.indexedDB.open(r,1).onupgradeneeded;return n.indexedDB.deleteDatabase&&n.indexedDB.deleteDatabase(r),n.localStorage&&(n.localStorage[e]=JSON.stringify(o)),o}function i(e,t){function o(e){e.createObjectStore(l,{keyPath:"id"}).createIndex("seq","seq",{unique:!0}),e.createObjectStore(f,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),e.createObjectStore(p,{keyPath:"digest"}),e.createObjectStore(v,{keyPath:"id",autoIncrement:!1}),e.createObjectStore(h)}function c(e,t){return e._bulk_seq-t._bulk_seq}var d=1,l="document-store",f="by-sequence",p="attach-store",v="meta-store",h="detect-blob-support",m=e.name,y=n.indexedDB.open(m,d);"openReqList"in i||(i.openReqList={}),i.openReqList[m]=y;var g=null,_=null,b=[],w={},k=null;return y.onupgradeneeded=function(e){for(var t=e.target.result,n=e.oldVersion;n!==e.newVersion;)0===n&&o(t),n++},y.onsuccess=function(e){k=e.target.result,k.onversionchange=function(){k.close()};var n=k.transaction([v,h],"readwrite"),r=n.objectStore(v).get(v);r.onsuccess=function(e){var r=e.target.result||{id:v};m+"_id"in r?_=r[m+"_id"]:(_=a.uuid(),r[m+"_id"]=_,n.objectStore(v).put(r));for(;b.length>0;){var o=b.pop();o(_)}try{n.objectStore(h).put(a.createBlob(),"key"),g=!0}catch(i){g=!1}finally{a.call(t,null,w)}}},y.onerror=r(t),w.type=function(){return"idb"},w.id=function(e){_?e(_):b.push(e)},w._bulkDocs=function(e,t,n){function o(e){var t=e.target.result;t.updateSeq=(t.updateSeq||0)+T,A.objectStore(v).put(t)}function d(){if(!x.length)return void(A.objectStore(v).get(v).onsuccess=o);var e=x.shift(),t=A.objectStore(l).get(e.metadata.id);t.onsuccess=function(t){var n=t.target.result;n?w(n,e):q(e)}}function h(){var e=[];D.sort(c),D.forEach(function(t){if(delete t._bulk_seq,t.error)return void e.push(t);var n=t.metadata,r=s.winningRev(n);e.push({ok:!0,id:n.id,rev:r}),a.isLocalId(n.id)||(i.Changes.notify(m),i.Changes.notifyLocalWindows(m))}),a.call(n,null,e)}function y(e,t){if(e.stub)return t();if("string"==typeof e.data){var r;try{r=atob(e.data)}catch(o){var i=u.error(u.BAD_ARG,"Attachments need to be base64 encoded");return a.call(n,i)}if(e.digest="md5-"+a.Crypto.MD5(r),g){var s=e.content_type;r=a.fixBinary(r),e.data=a.createBlob([r],{type:s})}return t()}var c=new FileReader;c.onloadend=function(){e.digest="md5-"+a.Crypto.MD5(this.result),g||(e.data=btoa(this.result)),t()},c.readAsBinaryString(e.data)}function _(e){function t(){n++,x.length===n&&e()}if(!x.length)return e();var n=0;x.forEach(function(e){function n(){o++,o===r.length&&t()}var r=e.data&&e.data._attachments?Object.keys(e.data._attachments):[];if(!r.length)return t();var o=0;for(var i in e.data._attachments)e.data._attachments.hasOwnProperty(i)&&y(e.data._attachments[i],n)})}function b(e,t){function n(e){i||(e?(i=e,a.call(t,i)):s===u.length&&o())}function r(e){s++,n(e)}function o(){e.data._doc_id_rev=e.data._id+"::"+e.data._rev;var n=A.objectStore(f).put(e.data);n.onsuccess=function(n){e.metadata.seq=n.target.result,delete e.metadata.rev;var r=A.objectStore(l).put(e.metadata);r.onsuccess=function(){D.push(e),a.call(t)}}}var i=null,s=0;e.data._id=e.metadata.id,e.data._rev=e.metadata.rev,T++,a.isDeleted(e.metadata,e.metadata.rev)&&(e.data._deleted=!0);var u=e.data._attachments?Object.keys(e.data._attachments):[];for(var c in e.data._attachments)if(e.data._attachments[c].stub)s++,n();else{var d=e.data._attachments[c].data;delete e.data._attachments[c].data;var p=e.data._attachments[c].digest;E(e,p,d,r)}u.length||o()}function w(e,t){var n=s.merge(e.rev_tree,t.metadata.rev_tree[0],1e3),r=a.isDeleted(e),o=r&&a.isDeleted(t.metadata)||!r&&O&&"new_leaf"!==n.conflicts;return o?(D.push(S(u.REV_CONFLICT,t._bulk_seq)),d()):(t.metadata.rev_tree=n.tree,void b(t,d))}function q(e){return"was_delete"in t&&a.isDeleted(e.metadata)?(D.push(u.MISSING_DOC),d()):void b(e,d)}function S(e,t){return e._bulk_seq=t,e}function E(e,t,n,r){{var o=A.objectStore(p);o.get(t).onsuccess=function(i){var s=i.target.result&&i.target.result.refs||{},u=[e.metadata.id,e.metadata.rev].join("@"),c={digest:t,body:n,refs:s};c.refs[u]=!0;o.put(c).onsuccess=function(){a.call(r)}}}}var O=t.new_edits,R=e.docs,x=R.map(function(e,t){var n=a.parseDoc(e,O);return n._bulk_seq=t,n}),j=x.filter(function(e){return e.error});if(j.length)return a.call(n,j[0]);var A,D=[],T=0;_(function(){A=k.transaction([l,f,p,v],"readwrite"),A.onerror=r(n),A.ontimeout=r(n),A.oncomplete=h,d()})},w._get=function(e,t,n){function r(){a.call(n,c,{doc:o,metadata:i,ctx:d})}var o,i,c,d;t=a.extend(!0,{},t),d=t.ctx?t.ctx:k.transaction([l,f,p],"readonly"),d.objectStore(l).get(e).onsuccess=function(e){if(i=e.target.result,!i)return c=u.MISSING_DOC,r();if(a.isDeleted(i)&&!t.rev)return c=u.error(u.MISSING_DOC,"deleted"),r();var n=s.winningRev(i),l=i.id+"::"+(t.rev?t.rev:n),p=d.objectStore(f).index("_doc_id_rev");p.get(l).onsuccess=function(e){return o=e.target.result,o&&o._doc_id_rev&&delete o._doc_id_rev,o?void r():(c=u.MISSING_DOC,r())}}},w._getAttachment=function(e,t,n){var r,o;t=a.extend(!0,{},t),o=t.ctx?t.ctx:k.transaction([l,f,p],"readonly");var i=e.digest,s=e.content_type;o.objectStore(p).get(i).onsuccess=function(e){var o=e.target.result.body;if(t.encode)if(g){var i=new FileReader;i.onloadend=function(){r=btoa(this.result),a.call(n,null,r)},i.readAsBinaryString(o)}else r=o,a.call(n,null,r);else g?r=o:(o=a.fixBinary(atob(o)),r=a.createBlob([o],{type:s})),a.call(n,null,r)}},w._allDocs=function(e,t){var r="startkey"in e?e.startkey:!1,o="endkey"in e?e.endkey:!1,i="key"in e?e.key:!1,u="keys"in e?e.keys:!1,c="descending"in e?e.descending:!1;c=c?"prev":null;var d=r&&o?n.IDBKeyRange.bound(r,o):r?n.IDBKeyRange.lowerBound(r):o?n.IDBKeyRange.upperBound(o):i?n.IDBKeyRange.only(i):null,p=k.transaction([l,f],"readonly");p.oncomplete=function(){u&&(u.forEach(function(e){m.push(e in y?y[e]:{key:e,error:"not_found"})}),e.descending&&m.reverse()),a.call(t,null,{total_rows:m.length,offset:e.skip,rows:"limit"in e?m.slice(e.skip,e.limit+e.skip):e.skip>0?m.slice(e.skip):m})};var v=p.objectStore(l),h=c?v.openCursor(d,c):v.openCursor(d),m=[],y={};h.onsuccess=function(t){function n(t,n){if(a.isLocalId(t.id))return r["continue"]();var o={id:t.id,key:t.id,value:{rev:s.winningRev(t)}};if(e.include_docs){o.doc=n,o.doc._rev=s.winningRev(t),o.doc._doc_id_rev&&delete o.doc._doc_id_rev,e.conflicts&&(o.doc._conflicts=s.collectConflicts(t));for(var i in o.doc._attachments)o.doc._attachments.hasOwnProperty(i)&&(o.doc._attachments[i].stub=!0)}"keys"in e?u.indexOf(t.id)>-1&&(a.isDeleted(t)&&(o.value.deleted=!0,o.doc=null),y[o.id]=o):a.isDeleted(t)||m.push(o),r["continue"]()}if(t.target.result){var r=t.target.result,o=r.value;if(e.include_docs){var i=p.objectStore(f).index("_doc_id_rev"),c=s.winningRev(o),d=o.id+"::"+c;i.get(d).onsuccess=function(e){n(r.value,e.target.result)}}else n(o)}}},w._info=function(e){function t(e){o=e.target.result&&e.target.result.updateSeq||0}function n(e){var n=e.target.result;return n?(n.value.deleted!==!0&&r++,void n["continue"]()):void(i.objectStore(v).get(v).onsuccess=t)}var r=0,o=0,i=k.transaction([l,v],"readonly");i.oncomplete=function(){e(null,{db_name:m,doc_count:r,update_seq:o})},i.objectStore(l).openCursor().onsuccess=n},w._changes=function(e){function t(){v=k.transaction([l,f]),v.oncomplete=o;var t;t=d?v.objectStore(f).openCursor(n.IDBKeyRange.lowerBound(e.since,!0),d):v.objectStore(f).openCursor(n.IDBKeyRange.lowerBound(e.since,!0)),t.onsuccess=r,t.onerror=u}function r(t){if(!t.target.result){for(var n=0,r=h.length;r>n;n++){var o=h[n];o&&g.push(o)}return!1}var i=t.target.result,u=i.value._id,c=y[u];if(void 0!==c)return h[c].seq=i.key,h.push(h[c]),h[c]=null,y[u]=h.length-1,i["continue"]();var d=v.objectStore(l);d.get(i.value._id).onsuccess=function(t){var n=t.target.result;if(a.isLocalId(n.id))return i["continue"]();p<n.seq&&(p=n.seq);var r=s.winningRev(n),o=n.id+"::"+r,u=v.objectStore(f).index("_doc_id_rev");u.get(o).onsuccess=function(t){var o=t.target.result;delete o._doc_id_rev,o._rev=r;var a=e.processChange(o,n,e);a.seq=i.key;var s=a.id,u=y[s];void 0!==u&&(h[u]=null),h.push(a),y[s]=h.length-1,i["continue"]()}}}function o(){a.processChanges(e,g,p)}function u(){a.call(e.complete)}if(e=a.extend(!0,{},e),e.continuous){var c=m+":"+a.uuid();return e.cancelled=!1,i.Changes.addListener(m,c,w,e),i.Changes.notify(m),{cancel:function(){e.cancelled=!0,i.Changes.removeListener(m,c)}}}var d=e.descending?"prev":null,p=0;e.since=e.since&&!d?e.since:0;var v,h=[],y={},g=[];t()},w._close=function(e){return null===k?a.call(e,u.NOT_OPEN):(k.close(),void a.call(e,null))},w._getRevisionTree=function(e,t){var n=k.transaction([l],"readonly"),r=n.objectStore(l).get(e);r.onsuccess=function(e){var n=e.target.result;n?a.call(t,null,n.rev_tree):a.call(t,u.MISSING_DOC)
}},w._doCompaction=function(e,t,n,r){var o=k.transaction([l,f],"readwrite"),i=o.objectStore(l);i.get(e).onsuccess=function(r){var i=r.target.result;i.rev_tree=t;var a=n.length;n.forEach(function(t){var n=o.objectStore(f).index("_doc_id_rev"),r=e+"::"+t;n.getKey(r).onsuccess=function(e){var t=e.target.result;if(t){{o.objectStore(f)["delete"](t)}a--,a||o.objectStore(l).put(i)}}})},o.oncomplete=function(){a.call(r)}},w}var a=e("../utils"),s=e("../merge"),u=e("../deps/errors");i.valid=function(){return n.indexedDB&&o()},i.destroy=a.toPromise(function(e,t,o){"openReqList"in i||(i.openReqList={}),i.Changes.clearListeners(e),i.openReqList[e]&&i.openReqList[e].result&&i.openReqList[e].result.close();var s=n.indexedDB.deleteDatabase(e);s.onsuccess=function(){i.openReqList[e]&&(i.openReqList[e]=null),a.call(o,null)},s.onerror=r(o)}),i.Changes=new a.Changes,t.exports=i}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../deps/errors":8,"../merge":14,"../utils":17}],4:[function(e,t){(function(n){"use strict";function r(e){return"'"+e+"'"}function o(){return"undefined"!=typeof n?n.navigator&&n.navigator.sqlitePlugin&&n.navigator.sqlitePlugin.openDatabase?navigator.sqlitePlugin.openDatabase.apply(navigator.sqlitePlugin,arguments):n.sqlitePlugin&&n.sqlitePlugin.openDatabase?n.sqlitePlugin.openDatabase.apply(n.sqlitePlugin,arguments):n.openDatabase.apply(n,arguments):void 0}function i(e){return function(t){var n=t&&t.constructor.toString().match(/function ([^\(]+)/),r=n&&n[1]||t.type,o=t.target||t.message;l.call(e,p.error(p.WSQ_ERROR,o,r))}}function a(e){for(var t="",n=0,r=e.length;r>n;n+=2)t+=String.fromCharCode(parseInt(e.substring(n,n+2),16));return t}function s(e){for(var t=1,n=e.length;n>t;t+=2)if("\x00"!==e.charAt(t))return!1;return!0}function u(e){for(var t="",n=0,r=e.length;r>n;n+=2)t+=e.charAt(n);return t}function c(e){var t;try{t=decodeURIComponent(window.escape(e))}catch(n){t=e}return s(t)?u(t):t}function d(e,t){function s(){t(null,b)}function u(){S.transaction(function(e){var t="CREATE TABLE IF NOT EXISTS "+_+" (update_seq, dbid)",n="CREATE TABLE IF NOT EXISTS "+g+" (digest, json, body BLOB)",r="CREATE TABLE IF NOT EXISTS "+m+" (id unique, seq, json, winningseq)",o="CREATE TABLE IF NOT EXISTS "+y+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, doc_id_rev UNIQUE, json)";e.executeSql(n),e.executeSql(r),e.executeSql(o),e.executeSql(t);var i="SELECT update_seq FROM "+_;e.executeSql(i,[],function(e,t){if(!t.rows.length){var n="INSERT INTO "+_+" (update_seq) VALUES (?)";return void e.executeSql(n,[0])}});var a="SELECT dbid FROM "+_+" WHERE dbid IS NOT NULL";e.executeSql(a,[],function(e,t){if(t.rows.length)w=t.rows.item(0).dbid;else{var n="UPDATE "+_+" SET dbid=?";w=l.uuid(),e.executeSql(n,[w])}for(;k.length>0;){var r=k.pop();r(w)}})},i(t),s)}var b={},w=null,k=[],q=e.name,S=o(q,v,q,h);return S?(l.isCordova()&&"undefined"!=typeof n?n.addEventListener(q+"_pouch",function E(){n.removeEventListener(q+"_pouch",E,!1),u()},!1):u(),b.type=function(){return"websql"},b.id=function(e){w?e(w):k.push(e)},b._info=function(e){S.transaction(function(t){var n="SELECT COUNT(id) AS count FROM "+m;t.executeSql(n,[],function(t,n){var r=n.rows.item(0).count,o="SELECT update_seq FROM "+_;t.executeSql(o,[],function(t,n){var o=n.rows.item(0).update_seq;e(null,{db_name:q,doc_count:r,update_seq:o})})})})},b._bulkDocs=function(e,t,n){function r(e,t){return e._bulk_seq-t._bulk_seq}function o(){var e=[];D.sort(r),D.forEach(function(t){if(delete t._bulk_seq,t.error)return void e.push(t);var n=t.metadata,r=f.winningRev(n);e.push({ok:!0,id:n.id,rev:r}),l.isLocalId(n.id)||(R++,d.Changes.notify(q),d.Changes.notifyLocalWindows(q))});var t="SELECT update_seq FROM "+_;A.executeSql(t,[],function(t,r){var o=r.rows.item(0).update_seq+R,i="UPDATE "+_+" SET update_seq=?";t.executeSql(i,[o],function(){l.call(n,null,e)})})}function a(e,t){if(e.stub)return t();if("string"==typeof e.data){try{e.data=atob(e.data)}catch(r){var o=p.error(p.BAD_ARG,"Attachments need to be base64 encoded");return l.call(n,o)}var i=l.fixBinary(e.data);e.data=l.createBlob([i],{type:e.content_type})}var a=new FileReader;a.onloadend=function(){e.data=this.result,e.digest="md5-"+l.Crypto.MD5(this.result),t()},a.readAsBinaryString(e.data)}function s(e){function t(){n++,x.length===n&&e()}if(!x.length)return e();var n=0;x.forEach(function(e){function n(){o++,o===r.length&&t()}var r=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],o=0;if(!r.length)return t();for(var i in e.data._attachments)e.data._attachments.hasOwnProperty(i)&&a(e.data._attachments[i],n)})}function u(e,t,n){function r(){var t=e.data,n="INSERT INTO "+y+" (doc_id_rev, json) VALUES (?, ?);";A.executeSql(n,[t._id+"::"+t._rev,JSON.stringify(t)],a)}function o(e){s||(e?(s=e,l.call(t,s)):u===c.length&&r())}function i(e){u++,o(e)}function a(r,o){var i=e.metadata.seq=o.insertId;delete e.metadata.rev;var a=f.winningRev(e.metadata),s=n?"UPDATE "+m+" SET seq=?, json=?, winningseq=(SELECT seq FROM "+y+" WHERE doc_id_rev=?) WHERE id=?":"INSERT INTO "+m+" (id, seq, winningseq, json) VALUES (?, ?, ?, ?);",u=JSON.stringify(e.metadata),c=e.metadata.id+"::"+a,d=n?[i,u,c,e.metadata.id]:[e.metadata.id,i,i,u];r.executeSql(s,d,function(){D.push(e),l.call(t,null)})}var s=null,u=0;e.data._id=e.metadata.id,e.data._rev=e.metadata.rev,l.isDeleted(e.metadata,e.metadata.rev)&&(e.data._deleted=!0);var c=e.data._attachments?Object.keys(e.data._attachments):[];for(var d in e.data._attachments)if(e.data._attachments[d].stub)u++,o();else{var p=e.data._attachments[d].data;delete e.data._attachments[d].data;var v=e.data._attachments[d].digest;w(e,v,p,i)}c.length||r()}function c(e,t){var n=f.merge(e.rev_tree,t.metadata.rev_tree[0],1e3),r=l.isDeleted(e)&&l.isDeleted(t.metadata)||!l.isDeleted(e)&&E&&"new_leaf"!==n.conflicts;return r?(D.push(b(p.REV_CONFLICT,t._bulk_seq)),h()):(t.metadata.rev_tree=n.tree,void u(t,h,!0))}function v(e){return"was_delete"in t&&l.isDeleted(e.metadata)?(D.push(p.MISSING_DOC),h()):void u(e,h,!1)}function h(){if(!x.length)return o();var e=x.shift(),t=e.metadata.id;t in T?c(T[t],e):(T[t]=e.metadata,v(e))}function b(e,t){return e._bulk_seq=t,e}function w(e,t,n,r){var o=[e.metadata.id,e.metadata.rev].join("@"),i={digest:t},a="SELECT digest, json FROM "+g+" WHERE digest=?";A.executeSql(a,[t],function(e,s){s.rows.length?(i.refs=JSON.parse(s.rows.item(0).json).refs,a="UPDATE "+g+" SET json=?, body=? WHERE digest=?",e.executeSql(a,[JSON.stringify(i),n,t],function(){l.call(r,null)})):(i.refs={},i.refs[o]=!0,a="INSERT INTO "+g+"(digest, json, body) VALUES (?, ?, ?)",e.executeSql(a,[t,JSON.stringify(i),n],function(){l.call(r,null)}))})}function k(e,t){for(var n=0;n<t.rows.length;n++){var r=t.rows.item(n);T[r.id]=JSON.parse(r.json)}h()}var E=t.new_edits,O=e.docs,R=0,x=O.map(function(e,t){var n=l.parseDoc(e,E);return n._bulk_seq=t,n}),j=x.filter(function(e){return e.error});if(j.length)return l.call(n,j[0]);var A,D=[],T={};s(function(){S.transaction(function(e){A=e;var t="SELECT * FROM "+m+" WHERE id IN ("+x.map(function(){return"?"}).join(",")+")",n=x.map(function(e){return e.metadata.id});A.executeSql(t,n,k)},i(n))})},b._get=function(e,t,n){function r(){l.call(n,a,{doc:o,metadata:i,ctx:s})}t=l.extend(!0,{},t);var o,i,a;if(!t.ctx)return void S.transaction(function(r){t.ctx=r,b._get(e,t,n)});var s=t.ctx,u="SELECT * FROM "+m+" WHERE id=?";s.executeSql(u,[e],function(e,n){if(!n.rows.length)return a=p.MISSING_DOC,r();if(i=JSON.parse(n.rows.item(0).json),l.isDeleted(i)&&!t.rev)return a=p.error(p.MISSING_DOC,"deleted"),r();var u=f.winningRev(i),c=t.rev?t.rev:u;c=i.id+"::"+c;var d="SELECT * FROM "+y+" WHERE doc_id_rev=?";s.executeSql(d,[c],function(e,t){return t.rows.length?(o=JSON.parse(t.rows.item(0).json),void r()):(a=p.MISSING_DOC,r())})})},b._allDocs=function(e,t){var n=[],r={},o="startkey"in e?e.startkey:!1,a="endkey"in e?e.endkey:!1,s="key"in e?e.key:!1,u="descending"in e?e.descending:!1,c="SELECT "+m+".id, "+y+".seq, "+y+".json AS data, "+m+".json AS metadata FROM "+y+" JOIN "+m+" ON "+y+".seq = "+m+".winningseq",d=[];"keys"in e?(c+=" WHERE "+m+".id IN ("+e.keys.map(function(){return"?"}).join(",")+")",d=d.concat(e.keys)):(o&&(c+=" WHERE "+m+".id >= ?",d.push(o)),a&&(c+=(o?" AND ":" WHERE ")+m+".id <= ?",d.push(a)),s&&(c+=(o||a?" AND ":" WHERE ")+m+".id = ?",d.push(s)),c+=" ORDER BY "+m+".id "+(u?"DESC":"ASC")),S.transaction(function(t){t.executeSql(c,d,function(t,o){for(var i=0,a=o.rows.length;a>i;i++){var s=o.rows.item(i),u=JSON.parse(s.metadata),c=JSON.parse(s.data);if(!l.isLocalId(u.id)){if(s={id:u.id,key:u.id,value:{rev:f.winningRev(u)}},e.include_docs){s.doc=c,s.doc._rev=f.winningRev(u),e.conflicts&&(s.doc._conflicts=f.collectConflicts(u));for(var d in s.doc._attachments)s.doc._attachments.hasOwnProperty(d)&&(s.doc._attachments[d].stub=!0)}"keys"in e?e.keys.indexOf(u.id)>-1&&(l.isDeleted(u)&&(s.value.deleted=!0,s.doc=null),r[s.id]=s):l.isDeleted(u)||n.push(s)}}})},i(t),function(){"keys"in e&&(e.keys.forEach(function(e){n.push(e in r?r[e]:{key:e,error:"not_found"})}),e.descending&&n.reverse()),l.call(t,null,{total_rows:n.length,offset:e.skip,rows:"limit"in e?n.slice(e.skip,e.limit+e.skip):e.skip>0?n.slice(e.skip):n})})},b._changes=function(e){function t(){var t="SELECT "+m+".id, "+y+".seq, "+y+".json AS data, "+m+".json AS metadata FROM "+y+" JOIN "+m+" ON "+y+".seq = "+m+".winningseq WHERE "+m+".seq > "+e.since+" ORDER BY "+m+".seq "+(r?"DESC":"ASC");S.transaction(function(n){n.executeSql(t,[],function(t,n){for(var r=0,i=0,a=n.rows.length;a>i;i++){var s=n.rows.item(i),u=JSON.parse(s.metadata);if(!l.isLocalId(u.id)){r<s.seq&&(r=s.seq);var c=JSON.parse(s.data),d=e.processChange(c,u,e);d.seq=s.seq,o.push(d)}}l.processChanges(e,o,r)})})}if(e=l.extend(!0,{},e),e.continuous){var n=q+":"+l.uuid();return e.cancelled=!1,d.Changes.addListener(q,n,b,e),d.Changes.notify(q),{cancel:function(){e.cancelled=!0,d.Changes.removeListener(q,n)}}}var r=e.descending;e.since=e.since&&!r?e.since:0;var o=[];t()},b._close=function(e){l.call(e,null)},b._getAttachment=function(e,t,n){var r,o=t.ctx,i=e.digest,s=e.content_type,u="SELECT hex(body) as body FROM "+g+" WHERE digest=?";o.executeSql(u,[i],function(e,o){var i=c(a(o.rows.item(0).body));t.encode?r=btoa(i):(i=l.fixBinary(i),r=l.createBlob([i],{type:s})),l.call(n,null,r)})},b._getRevisionTree=function(e,t){S.transaction(function(n){var r="SELECT json AS metadata FROM "+m+" WHERE id = ?";n.executeSql(r,[e],function(e,n){if(n.rows.length){var r=JSON.parse(n.rows.item(0).metadata);l.call(t,null,r.rev_tree)}else l.call(t,p.MISSING_DOC)})})},b._doCompaction=function(e,t,n,o){S.transaction(function(i){var a="SELECT json AS metadata FROM "+m+" WHERE id = ?";i.executeSql(a,[e],function(i,a){if(!a.rows.length)return l.call(o);var s=JSON.parse(a.rows.item(0).metadata);s.rev_tree=t;var u="DELETE FROM "+y+" WHERE doc_id_rev IN ("+n.map(function(t){return r(e+"::"+t)}).join(",")+")";i.executeSql(u,[],function(t){var n="UPDATE "+m+" SET json = ? WHERE id = ?";t.executeSql(n,[JSON.stringify(s),e],function(){o()})})})})},b):l.call(t,p.UNKNOWN_ERROR)}var l=e("../utils"),f=e("../merge"),p=e("../deps/errors"),v=1,h=5242880,m=r("document-store"),y=r("by-sequence"),g=r("attach-store"),_=r("metadata-store");d.valid=function(){if("undefined"!=typeof n){if(n.navigator&&n.navigator.sqlitePlugin&&n.navigator.sqlitePlugin.openDatabase)return!0;if(n.sqlitePlugin&&n.sqlitePlugin.openDatabase)return!0;if(n.openDatabase)return!0}return!1},d.destroy=l.toPromise(function(e,t,n){var r=o(e,v,e,h);r.transaction(function(e){e.executeSql("DROP TABLE IF EXISTS "+m,[]),e.executeSql("DROP TABLE IF EXISTS "+y,[]),e.executeSql("DROP TABLE IF EXISTS "+g,[]),e.executeSql("DROP TABLE IF EXISTS "+_,[])},i(n),function(){l.call(n,null)})}),d.Changes=new l.Changes,t.exports=d}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../deps/errors":8,"../merge":14,"../utils":17}],5:[function(e,t){(function(n){"use strict";function r(e){e&&n.debug&&console.error(e)}function o(e,t,n){if(!(this instanceof o))return new o(e,t,n);var u=this;("function"==typeof t||"undefined"==typeof t)&&(n=t,t={}),"object"==typeof e&&(t=e,e=void 0),"undefined"==typeof n&&(n=r);var c=n,d=new s(function(r,s){n=function(e,t){return e?s(e):(delete t.then,void r(t))},t=a.extend(!0,{},t);var c=t.name||e,d=o.parseAdapter(c);if(t.originalName=c,t.name=d.name,t.adapter=t.adapter||d.adapter,!o.adapters[t.adapter])throw"Adapter is missing";if(!o.adapters[t.adapter].valid())throw"Invalid Adapter";var l=new i(t,function(e){if(e)return void(n&&n(e));for(var t in o.plugins)if(o.plugins.hasOwnProperty(t)){var r=o.plugins[t](u);for(var i in r)r.hasOwnProperty(i)&&(i in u||(u[i]=r[i]))}u.taskqueue.ready(!0),u.taskqueue.execute(u),n(null,u)});for(var f in l)l.hasOwnProperty(f)&&(u[f]=l[f]);for(var p in o.plugins)if(o.plugins.hasOwnProperty(p)){var v=o.plugins[p](u);for(var h in v)v.hasOwnProperty(h)&&(h in u||(u[h]=v[h]))}});d.then(function(e){c(null,e)},c),u.then=d.then.bind(d),function(){try{u.catch=d.catch.bind(d)}catch(e){}}()}var i=e("./adapter")(o),a=e("./utils"),s="function"==typeof n.Promise?n.Promise:e("bluebird");t.exports=o}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter":1,"./utils":17,bluebird:21}],6:[function(e,t){(function(n){"use strict";function r(e,t){function r(e){var t=Array.prototype.slice.call(arguments,1);typeof e==typeof Function&&e.apply(this,t)}function c(t,n,o){if(e.binary||e.json||!e.processData||"string"==typeof t){if(!e.binary&&e.json&&"string"==typeof t)try{t=JSON.parse(t)}catch(i){return void r(o,i)}}else t=JSON.stringify(t);Array.isArray(t)&&(t=t.map(function(e){var t;return e.ok?e:e.error&&"conflict"===e.error?(t=s.REV_CONFLICT,t.id=e.id,t):e.missing?(t=s.MISSING_DOC,t.missing=e.missing,t):e})),r(o,null,t,n)}function d(e,t){var n,o,i,a;try{n=JSON.parse(e.responseText);for(a in s)if(s.hasOwnProperty(a)&&s[a].name===n.error){i=s[a];break}i=i||s.UNKNOWN_ERROR,o=s.error(i,n.reason)}catch(u){for(var a in s)if(s.hasOwnProperty(a)&&s[a].status===e.status){i=s[a];break}i=i||s.UNKNOWN_ERROR,o=s.error(i)}r(t,o)}"function"==typeof e&&(t=e,e={}),e=i(!0,{},e);var l={method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1};if(e=i(!0,l,e),"GET"===e.method&&!e.cache){var f=-1!==e.url.indexOf("?");e.url+=(f?"&":"?")+"_nonce="+u(16)}if(n.browser&&"undefined"!=typeof XMLHttpRequest){var p,v=!1,h=new XMLHttpRequest;h.open(e.method,e.url),h.withCredentials=!0,e.json&&(e.headers.Accept="application/json",e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.body&&e.processData&&"string"!=typeof e.body&&(e.body=JSON.stringify(e.body))),e.binary&&(h.responseType="arraybuffer");var m=function(e,t,n){var r="";if(n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3),r="; expires="+o.toGMTString()}document.cookie=e+"="+t+r+"; path=/"};for(var y in e.headers)if("Cookie"===y){var g=e.headers[y].split("=");m(g[0],g[1],10)}else h.setRequestHeader(y,e.headers[y]);"body"in e||(e.body=null);var _=function(){v=!0,h.abort(),r(d,h,t)};return h.onreadystatechange=function(){if(4===h.readyState&&!v)if(clearTimeout(p),h.status>=200&&h.status<300){var n;n=e.binary?a([h.response||""],{type:h.getResponseHeader("Content-Type")}):h.responseText,r(c,n,h,t)}else r(d,h,t)},e.timeout>0&&(p=setTimeout(_,e.timeout),h.onprogress=function(){clearTimeout(p),p=setTimeout(_,e.timeout)},h.upload&&(h.upload.onprogress=h.onprogress)),h.send(e.body),{abort:_}}return e.json&&(e.binary||(e.headers.Accept="application/json"),e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json"),e.binary&&(e.encoding=null,e.json=!1),e.processData||(e.json=!1),o(e,function(n,o,i){if(n)return n.status=o?o.statusCode:400,r(d,n,t);var a,u=o.headers["content-type"],l=i||"";e.binary||!e.json&&e.processData||"object"==typeof l||!(/json/.test(u)||/^[\s]*\{/.test(l)&&/\}[\s]*$/.test(l))||(l=JSON.parse(l)),o.statusCode>=200&&o.statusCode<300?r(c,l,o,t):(e.binary&&(l=JSON.parse(l.toString())),a="missing"===l.reason?s.MISSING_DOC:"no_db_file"===l.reason?s.error(s.DB_MISSING,l.reason):"conflict"===l.error?s.REV_CONFLICT:s.error(s.UNKNOWN_ERROR,l.reason,l.error),a.status=o.statusCode,r(t,a))})}var o=e("request"),i=e("./extend.js"),a=e("./blob.js"),s=e("./errors"),u=e("../deps/uuid");t.exports=r}).call(this,e("/Users/philipp.reinking/workspace/pouch_fix/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"../deps/uuid":12,"./blob.js":7,"./errors":8,"./extend.js":10,"/Users/philipp.reinking/workspace/pouch_fix/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":20,request:19}],7:[function(e,t){(function(e){"use strict";function n(t,n){t=t||[],n=n||{};try{return new Blob(t,n)}catch(r){if("TypeError"!==r.name)throw r;for(var o=e.BlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder||e.WebKitBlobBuilder,i=new o,a=0;a<t.length;a+=1)i.append(t[a]);return i.getBlob(n.type)}}t.exports=n}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(e,t,n){"use strict";function r(e){this.status=e.status,this.name=e.error,this.message=e.reason,this.error=!0}r.prototype=new Error,n.UNAUTHORIZED=new r({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),n.MISSING_BULK_DOCS=new r({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),n.MISSING_DOC=new r({status:404,error:"not_found",reason:"missing"}),n.REV_CONFLICT=new r({status:409,error:"conflict",reason:"Document update conflict"}),n.INVALID_ID=new r({status:400,error:"invalid_id",reason:"_id field must contain a string"}),n.MISSING_ID=new r({status:412,error:"missing_id",reason:"_id is required for puts"}),n.RESERVED_ID=new r({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),n.NOT_OPEN=new r({status:412,error:"precondition_failed",reason:"Database not open so cannot close"}),n.UNKNOWN_ERROR=new r({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),n.BAD_ARG=new r({status:500,error:"badarg",reason:"Some query argument is invalid"}),n.INVALID_REQUEST=new r({status:400,error:"invalid_request",reason:"Request was invalid"}),n.QUERY_PARSE_ERROR=new r({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),n.DOC_VALIDATION=new r({status:500,error:"doc_validation",reason:"Bad special document member"}),n.BAD_REQUEST=new r({status:400,error:"bad_request",reason:"Something wrong with the request"}),n.NOT_AN_OBJECT=new r({status:400,error:"bad_request",reason:"Document must be a JSON object"}),n.DB_MISSING=new r({status:404,error:"not_found",reason:"Database not found"}),n.IDB_ERROR=new r({status:500,error:"indexed_db_went_bad",reason:"unknown"}),n.WSQ_ERROR=new r({status:500,error:"web_sql_went_bad",reason:"unknown"}),n.LDB_ERROR=new r({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),n.error=function(e,t,n){function r(){this.message=t,n&&(this.name=n)}return r.prototype=e,new r(t)}},{}],9:[function(){"use strict";Object.keys||(Object.keys=function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on a non-object");var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),"forEach"in Array.prototype||(Array.prototype.forEach=function(e,t){for(var n=0,r=this.length;r>n;n++)n in this&&e.call(t,this[n],n,this)}),"map"in Array.prototype||(Array.prototype.map=function(e,t){for(var n=new Array(this.length),r=0,o=this.length;o>r;r++)r in this&&(n[r]=e.call(t,this[r],r,this));return n})},{}],10:[function(e,t){"use strict";function n(e){return null===e?String(e):"object"==typeof e||"function"==typeof e?s[l.call(e)]||"object":typeof e}function r(e){return null!==e&&e===e.window}function o(e){if(!e||"object"!==n(e)||e.nodeType||r(e))return!1;try{if(e.constructor&&!f.call(e,"constructor")&&!f.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}var o;for(o in e);return void 0===o||f.call(e,o)}function i(e){return"function"===n(e)}function a(){var e,t,n,r,s,u,c=arguments[0]||{},d=1,l=arguments.length,f=!1;for("boolean"==typeof c&&(f=c,c=arguments[1]||{},d=2),"object"==typeof c||i(c)||(c={}),l===d&&(c=this,--d);l>d;d++)if(null!=(e=arguments[d]))for(t in e)if(!(t in Object.prototype)){if(n=c[t],r=e[t],c===r)continue;f&&r&&(o(r)||(s=p(r)))?(s?(s=!1,u=n&&p(n)?n:[]):u=n&&o(n)?n:{},c[t]=a(f,u,r)):void 0!==r&&(p(e)&&i(r)||(c[t]=r))}return c}for(var s={},u=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"],c=0;c<u.length;c++){var d=u[c];s["[object "+d+"]"]=d.toLowerCase()}var l=s.toString,f=s.hasOwnProperty,p=Array.isArray||function(e){return"array"===n(e)};t.exports=a},{}],11:[function(e,t,n){(function(t){"use strict";var r=e("crypto");n.MD5=function(e){function n(e,t){return e<<t|e>>>32-t}function o(e,t){var n,r,o,i,a;return o=2147483648&e,i=2147483648&t,n=1073741824&e,r=1073741824&t,a=(1073741823&e)+(1073741823&t),n&r?2147483648^a^o^i:n|r?1073741824&a?3221225472^a^o^i:1073741824^a^o^i:a^o^i}function i(e,t,n){return e&t|~e&n}function a(e,t,n){return e&n|t&~n}function s(e,t,n){return e^t^n}function u(e,t,n){return t^(e|~n)}function c(e,t,r,a,s,u,c){return e=o(e,o(o(i(t,r,a),s),c)),o(n(e,u),t)}function d(e,t,r,i,s,u,c){return e=o(e,o(o(a(t,r,i),s),c)),o(n(e,u),t)}function l(e,t,r,i,a,u,c){return e=o(e,o(o(s(t,r,i),a),c)),o(n(e,u),t)}function f(e,t,r,i,a,s,c){return e=o(e,o(o(u(t,r,i),a),c)),o(n(e,s),t)}function p(e){for(var t,n=e.length,r=n+8,o=(r-r%64)/64,i=16*(o+1),a=new Array(i-1),s=0,u=0;n>u;)t=(u-u%4)/4,s=u%4*8,a[t]=a[t]|e.charCodeAt(u)<<s,u++;return t=(u-u%4)/4,s=u%4*8,a[t]=a[t]|128<<s,a[i-2]=n<<3,a[i-1]=n>>>29,a}function v(e){var t,n,r="",o="";for(n=0;3>=n;n++)t=e>>>8*n&255,o="0"+t.toString(16),r+=o.substr(o.length-2,2);return r}if(!t.browser)return r.createHash("md5").update(e).digest("hex");var h,m,y,g,_,b,w,k,q,S=[],E=7,O=12,R=17,x=22,j=5,A=9,D=14,T=20,C=4,N=11,I=16,P=23,L=6,B=10,M=15,U=21;for(S=p(e),b=1732584193,w=4023233417,k=2562383102,q=271733878,h=0;h<S.length;h+=16)m=b,y=w,g=k,_=q,b=c(b,w,k,q,S[h+0],E,3614090360),q=c(q,b,w,k,S[h+1],O,3905402710),k=c(k,q,b,w,S[h+2],R,606105819),w=c(w,k,q,b,S[h+3],x,3250441966),b=c(b,w,k,q,S[h+4],E,4118548399),q=c(q,b,w,k,S[h+5],O,1200080426),k=c(k,q,b,w,S[h+6],R,2821735955),w=c(w,k,q,b,S[h+7],x,4249261313),b=c(b,w,k,q,S[h+8],E,1770035416),q=c(q,b,w,k,S[h+9],O,2336552879),k=c(k,q,b,w,S[h+10],R,4294925233),w=c(w,k,q,b,S[h+11],x,2304563134),b=c(b,w,k,q,S[h+12],E,1804603682),q=c(q,b,w,k,S[h+13],O,4254626195),k=c(k,q,b,w,S[h+14],R,2792965006),w=c(w,k,q,b,S[h+15],x,1236535329),b=d(b,w,k,q,S[h+1],j,4129170786),q=d(q,b,w,k,S[h+6],A,3225465664),k=d(k,q,b,w,S[h+11],D,643717713),w=d(w,k,q,b,S[h+0],T,3921069994),b=d(b,w,k,q,S[h+5],j,3593408605),q=d(q,b,w,k,S[h+10],A,38016083),k=d(k,q,b,w,S[h+15],D,3634488961),w=d(w,k,q,b,S[h+4],T,3889429448),b=d(b,w,k,q,S[h+9],j,568446438),q=d(q,b,w,k,S[h+14],A,3275163606),k=d(k,q,b,w,S[h+3],D,4107603335),w=d(w,k,q,b,S[h+8],T,1163531501),b=d(b,w,k,q,S[h+13],j,2850285829),q=d(q,b,w,k,S[h+2],A,4243563512),k=d(k,q,b,w,S[h+7],D,1735328473),w=d(w,k,q,b,S[h+12],T,2368359562),b=l(b,w,k,q,S[h+5],C,4294588738),q=l(q,b,w,k,S[h+8],N,2272392833),k=l(k,q,b,w,S[h+11],I,1839030562),w=l(w,k,q,b,S[h+14],P,4259657740),b=l(b,w,k,q,S[h+1],C,2763975236),q=l(q,b,w,k,S[h+4],N,1272893353),k=l(k,q,b,w,S[h+7],I,4139469664),w=l(w,k,q,b,S[h+10],P,3200236656),b=l(b,w,k,q,S[h+13],C,681279174),q=l(q,b,w,k,S[h+0],N,3936430074),k=l(k,q,b,w,S[h+3],I,3572445317),w=l(w,k,q,b,S[h+6],P,76029189),b=l(b,w,k,q,S[h+9],C,3654602809),q=l(q,b,w,k,S[h+12],N,3873151461),k=l(k,q,b,w,S[h+15],I,530742520),w=l(w,k,q,b,S[h+2],P,3299628645),b=f(b,w,k,q,S[h+0],L,4096336452),q=f(q,b,w,k,S[h+7],B,1126891415),k=f(k,q,b,w,S[h+14],M,2878612391),w=f(w,k,q,b,S[h+5],U,4237533241),b=f(b,w,k,q,S[h+12],L,1700485571),q=f(q,b,w,k,S[h+3],B,2399980690),k=f(k,q,b,w,S[h+10],M,4293915773),w=f(w,k,q,b,S[h+1],U,2240044497),b=f(b,w,k,q,S[h+8],L,1873313359),q=f(q,b,w,k,S[h+15],B,4264355552),k=f(k,q,b,w,S[h+6],M,2734768916),w=f(w,k,q,b,S[h+13],U,1309151649),b=f(b,w,k,q,S[h+4],L,4149444226),q=f(q,b,w,k,S[h+11],B,3174756917),k=f(k,q,b,w,S[h+2],M,718787259),w=f(w,k,q,b,S[h+9],U,3951481745),b=o(b,m),w=o(w,y),k=o(k,g),q=o(q,_);var J=v(b)+v(w)+v(k)+v(q);return J.toLowerCase()}}).call(this,e("/Users/philipp.reinking/workspace/pouch_fix/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"/Users/philipp.reinking/workspace/pouch_fix/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":20,crypto:19}],12:[function(e,t){"use strict";function n(e,t){var r,o=n.CHARS,i=[];if(t=t||o.length,e)for(r=0;e>r;r++)i[r]=o[0|Math.random()*t];else{var a;for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",r=0;36>r;r++)i[r]||(a=0|16*Math.random(),i[r]=o[19===r?3&a|8:a])}return i.join("")}n.CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),t.exports=n},{}],13:[function(e,t){(function(n){"use strict";e("./deps/es5_shims");var r=e("./setup");t.exports=r,r.ajax=e("./deps/ajax"),r.extend=e("./deps/extend"),r.utils=e("./utils"),r.Errors=e("./deps/errors");var o=e("./replicate");r.replicate=o.replicate,r.sync=o.sync,r.version=e("./version");var i=e("./adapters/http");if(r.adapter("http",i),r.adapter("https",i),r.adapter("idb",e("./adapters/idb")),r.adapter("websql",e("./adapters/websql")),r.plugin("mapreduce",e("pouchdb-mapreduce")),!n.browser){var a=e("./adapters/leveldb");r.adapter("ldb",a),r.adapter("leveldb",a)}}).call(this,e("/Users/philipp.reinking/workspace/pouch_fix/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"./adapters/http":2,"./adapters/idb":3,"./adapters/leveldb":19,"./adapters/websql":4,"./deps/ajax":6,"./deps/errors":8,"./deps/es5_shims":9,"./deps/extend":10,"./replicate":15,"./setup":16,"./utils":17,"./version":18,"/Users/philipp.reinking/workspace/pouch_fix/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":20,"pouchdb-mapreduce":31}],14:[function(e,t){"use strict";function n(e){for(var t,n=e.shift(),r=[n.id,n.opts,[]],o=r;e.length;)n=e.shift(),t=[n.id,n.opts,[]],o[2].push(t),o=t;return r}function r(e,t){for(var n=[{tree1:e,tree2:t}],r=!1;n.length>0;){var o=n.pop(),i=o.tree1,a=o.tree2;(i[1].status||a[1].status)&&(i[1].status="available"===i[1].status||"available"===a[1].status?"available":"missing");for(var s=0;s<a[2].length;s++)if(i[2][0]){for(var u=!1,c=0;c<i[2].length;c++)i[2][c][0]===a[2][s][0]&&(n.push({tree1:i[2][c],tree2:a[2][s]}),u=!0);u||(r="new_branch",i[2].push(a[2][s]),i[2].sort())}else r="new_leaf",i[2][0]=a[2][s]}return{conflicts:r,tree:e}}function o(e,t,n){var o,i=[],a=!1,s=!1;return e.length?(e.forEach(function(e){if(e.pos===t.pos&&e.ids[0]===t.ids[0])o=r(e.ids,t.ids),i.push({pos:e.pos,ids:o.tree}),a=a||o.conflicts,s=!0;else if(n!==!0){var u=e.pos<t.pos?e:t,c=e.pos<t.pos?t:e,d=c.pos-u.pos,l=[],f=[];for(f.push({ids:u.ids,diff:d,parent:null,parentIdx:null});f.length>0;){var p=f.pop();0!==p.diff?p.ids&&p.ids[2].forEach(function(e,t){f.push({ids:e,diff:p.diff-1,parent:p.ids,parentIdx:t})}):p.ids[0]===c.ids[0]&&l.push(p)}var v=l[0];v?(o=r(v.ids,c.ids),v.parent[2][v.parentIdx]=o.tree,i.push({pos:u.pos,ids:u.ids}),a=a||o.conflicts,s=!0):i.push(e)}else i.push(e)}),s||i.push(t),i.sort(function(e,t){return e.pos-t.pos}),{tree:i,conflicts:a||"internal_node"}):{tree:[t],conflicts:"new_leaf"}}function i(e,t){var r=s.rootToLeaf(e).map(function(e){var r=e.ids.slice(-t);return{pos:e.pos+(e.ids.length-r.length),ids:n(r)}});return r.reduce(function(e,t){return o(e,t,!0).tree},[r.shift()])}var a=e("./deps/extend"),s={};s.merge=function(e,t,n){e=a(!0,[],e),t=a(!0,{},t);var r=o(e,t);return{tree:i(r.tree,n),conflicts:r.conflicts}},s.winningRev=function(e){var t=[];return s.traverseRevTree(e.rev_tree,function(e,n,r,o,i){e&&t.push({pos:n,id:r,deleted:!!i.deleted})}),t.sort(function(e,t){return e.deleted!==t.deleted?e.deleted>t.deleted?1:-1:e.pos!==t.pos?t.pos-e.pos:e.id<t.id?1:-1}),t[0].pos+"-"+t[0].id},s.traverseRevTree=function(e,t){var n=[];for(e.forEach(function(e){n.push({pos:e.pos,ids:e.ids})});n.length>0;){var r=n.pop(),o=r.pos,i=r.ids,a=t(0===i[2].length,o,i[0],r.ctx,i[1]);i[2].forEach(function(e){n.push({pos:o+1,ids:e,ctx:a})})}},s.collectLeaves=function(e){var t=[];return s.traverseRevTree(e,function(e,n,r,o,i){e&&t.unshift({rev:n+"-"+r,pos:n,opts:i})}),t.sort(function(e,t){return t.pos-e.pos}),t.map(function(e){delete e.pos}),t},s.collectConflicts=function(e){var t=s.winningRev(e),n=s.collectLeaves(e.rev_tree),r=[];return n.forEach(function(e){e.rev===t||e.opts.deleted||r.push(e.rev)}),r},s.rootToLeaf=function(e){var t=[];return s.traverseRevTree(e,function(e,n,r,o,i){if(o=o?o.slice(0):[],o.push({id:r,opts:i}),e){var a=n+1-o.length;t.unshift({pos:a,ids:o})}return o}),t},t.exports=s},{"./deps/extend":10}],15:[function(e,t,n){"use strict";function r(){var e=this;this.cancelled=!1,this.cancel=function(){e.cancelled=!0}}function o(){this.seq=0,this.state="start",this.changes=[],this.docs=[]}function i(e,t,n,r){var o=n.filter?n.filter.toString():"";e.id(function(e){t.id(function(t){var i=e+t+o+JSON.stringify(n.query_params);r("_local/"+f.Crypto.MD5(i))})})}function a(e,t,n,r){t.get(n,function(t,o){t&&404===t.status?r(null,0):t?r(t):e.get(n,function(e,t){e&&404===e.status||!e&&o.last_seq!==t.last_seq?r(null,0):e?r(e):r(null,t.last_seq)})})}function s(e,t,n,r,o){function i(e,t){e.get(n,function(o,i){if(o&&404===o.status)i={_id:n};else if(o)return t(o);i.last_seq=r,e.put(i,t)})}i(t,function(){i(e,function(){o()})})}function u(e,t,n,r,i){function u(){if(0===k[0].docs.length)return p();var e=k[0].docs;n.bulkDocs({docs:e},{new_edits:!1},function(t){return t?l("target.bulkDocs completed with error",t):(A.docs_written+=e.length,void p())})}function c(e,t){return i.cancelled?g():e?l("src.get completed with error",e):(Object.keys(t).forEach(function(e){var n=t[e].ok;n&&(A.docs_read++,k[0].pendingRevs++,k[0].docs.push(n))}),void d())}function d(){var e=k[0].diffs;if(0===Object.keys(e).length)return void u();var n=Object.keys(e)[0],r=e[n].missing;delete e[n],t.get(n,{revs:!0,open_revs:r,attachments:!0},c)}function l(e,t){A.ok=!1,A.status="aborted",A.errors.push(t),A.end_time=new Date,A.last_seq=O,i.cancel(),k=[],q=new o;var n={status:500,error:"Replication aborted",reason:e,details:t};f.call(r.complete,n,A)}function p(){s(t,n,e,k[0].seq,function(e){return e?l("writeCheckpoint completed with error",e):(O=k[0].seq,A.last_seq=O,f.call(r.onChange,null,A),k.shift(),void m())})}function v(e,t){return i.cancelled?g():e?l("target.revsDiff completed with error",e):0===Object.keys(t).length?void p():(k[0].diffs=t,k[0].pendingRevs=0,void d())}function h(){var e={};k[0].changes.forEach(function(t){e[t.id]=t.changes.map(function(e){return e.rev})}),n.revsDiff(e,v)}function m(){return i.cancelled?g():0===k.length?void(S?_():q.changes.length>0&&y()):void("start"===k[0].state&&(k[0].state="processing",h()))}function y(){return 0===q.changes.length?void(S&&0===k.length&&_()):void((S||q.changes.length>=x)&&(k.push(q),q=new o,m()))}function g(){A.status="cancelled",_()}function _(){return E?void 0:(E=!0,A.status=A.status||"complete",A.end_time=new Date,A.last_seq=O,f.call(r.complete,null,A))}function b(e){return i.cancelled?g():void(E||(q.seq=e.seq,q.changes.push(e),y()))}function w(e){return S=!0,i.cancelled?g():e?l("src.changes completed with error",e):void y()}var k=[],q=new o,S=!1,E=!1,O=0,R=r.continuous||!1,x=r.batch_size||1,j=r.doc_ids,A={ok:!0,start_time:new Date,docs_read:0,docs_written:0,errors:[]};a(t,n,e,function(e,n){if(e)return l("fetchCheckpoint completed with error",e);if(O=n,i.cancelled)return g();var o={continuous:R,since:O,style:"all_docs",onChange:b,complete:w,doc_ids:j};
r.filter&&(o.filter=r.filter),r.query_params&&(o.query_params=r.query_params);var a=t.changes(o);if(r.continuous){var s=i.cancel;i.cancel=function(){s(),a.cancel()}}})}function c(e,t){return"string"==typeof e?new p(e,t):void t(null,e)}function d(e,t,n,o){n instanceof Function&&(o=n,n={}),void 0===n&&(n={}),n.complete||(n.complete=o);var a=new r;return c(e,function(e,r){return e?f.call(o,e):void c(t,function(e,t){if(e)return f.call(o,e);if(n.server){if("function"!=typeof r.replicateOnServer)return f.call(o,{error:"Server replication not supported for "+r.type()+" adapter"});if(r.type()!==t.type())return f.call(o,{error:"Server replication for different adapter types ("+r.type()+" and "+t.type()+") is not supported"});r.replicateOnServer(t,n,a)}else i(r,t,n,function(e){u(e,r,t,n,a)})})}),a}function l(e,t,n,r){function o(e){return function(t,n){t&&c(),f.call(e,t,n)}}function i(e,t){return function(n){return{source:e,change:f.call(t,n)}}}function a(e,t){return t=f.extend(!0,{},t),t.complete=o(t.complete),t.onChange=i(e,t.onChange),t}function s(){return l=d(e,t,a(e,n),r)}function u(){return p=d(t,e,a(t,n),r)}function c(){l&&l.cancel(),p&&p.cancel()}var l,p;return{push:s(),pull:u(),cancel:c}}var f=e("./utils"),p=e("./index");n.replicate=d,n.sync=l},{"./index":13,"./utils":17}],16:[function(e,t){"use strict";var n=e("./constructor");n.adapters={},n.plugins={},n.prefix="_pouch_",n.parseAdapter=function(e){var t,r=e.match(/([a-z\-]*):\/\/(.*)/);if(r){if(e=/http(s?)/.test(r[1])?r[1]+"://"+r[2]:r[2],t=r[1],!n.adapters[t].valid())throw"Invalid adapter";return{name:e,adapter:r[1]}}for(var o=["idb","leveldb","websql"],i=0;i<o.length;++i)if(o[i]in n.adapters){t=n.adapters[o[i]];var a="use_prefix"in t?t.use_prefix:!0;return{name:a?n.prefix+e:e,adapter:o[i]}}throw"No valid adapter found"},n.destroy=function(e,t,r){("function"==typeof t||"undefined"==typeof t)&&(r=t,t={}),"object"==typeof e&&(t=e,e=void 0),"undefined"==typeof r&&(r=function(){});var o=n.parseAdapter(t.name||e),i=o.name,a=function(e){if(e)return void r(e);for(var a in n.plugins)n.plugins.hasOwnProperty(a)&&n.plugins[a]._delete(i);n.adapters[o.adapter].destroy(i,t,r)};n.removeFromAllDbs(o,a)},n.removeFromAllDbs=function(e,t){if(!n.enableAllDbs)return void t();var r=e.adapter;return"http"===r||"https"===r?void t():void new n(n.allDBName(e.adapter),function(r,o){if(r)return void t();var i=n.dbName(e.adapter,e.name);o.get(i,function(e,n){e?t():o.remove(n,function(e){t()})})})},n.adapter=function(e,t){t.valid()&&(n.adapters[e]=t)},n.plugin=function(e,t){n.plugins[e]=t},n.enableAllDbs=!1,n.ALL_DBS="_allDbs",n.dbName=function(e,t){return[e,"-",t].join("")},n.realDBName=function(e,t){return[e,"://",t].join("")},n.allDBName=function(e){return[e,"://",n.prefix+n.ALL_DBS].join("")},n.open=function(e,t){if(!n.enableAllDbs)return void t();var r=e.adapter;return"http"===r||"https"===r?void t():void new n(n.allDBName(r),function(o,i){if(o)return void t();var a=n.dbName(r,e.name);i.get(a,function(n){n&&404===n.status?i.put({_id:a,dbname:e.originalName},function(e){t()}):t()})})},n.allDbs=function(e){var t=function(r,o){if(0===r.length){var i=[];return o.forEach(function(e){var t=i.some(function(t){return t.id===e.id});t||i.push(e)}),void e(null,i.map(function(e){return e.doc.dbname}))}var a=r.shift();return"http"===a||"https"===a?void t(r,o):void new n(n.allDBName(a),function(n,i){return n?void e(n):void i.allDocs({include_docs:!0},function(n,i){return n?void e(n):(o.unshift.apply(o,i.rows),void t(r,o))})})},r=Object.keys(n.adapters);t(r,[])},t.exports=n},{"./constructor":5}],17:[function(e,t,n){(function(t,r){function o(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}var i=e("./merge");n.extend=e("./deps/extend"),n.ajax=e("./deps/ajax"),n.createBlob=e("./deps/blob");var a=e("./deps/uuid");n.Crypto=e("./deps/md5.js");var s=e("./deps/buffer"),u=e("./deps/errors"),c="function"==typeof r.Promise?r.Promise:e("bluebird"),d=["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree"];n.uuids=function(e,t){"object"!=typeof t&&(t={});for(var n=t.length,r=t.radix,o=[];o.push(a(n,r))<e;);return o},n.uuid=function(e){return n.uuids(1,e)[0]},n.isValidId=function(e){return e&&"string"==typeof e?/^_/.test(e)?/^_(design|local)/.test(e):!0:!1},n.call=function(e){if(typeof e==typeof Function){var t=Array.prototype.slice.call(arguments,1);e.apply(this,t)}},n.isLocalId=function(e){return/^_local/.test(e)},n.isDeleted=function(e,t){t||(t=i.winningRev(e)),t.indexOf("-")>=0&&(t=t.split("-")[1]);var n=!1;return i.traverseRevTree(e.rev_tree,function(e,r,o,i,a){o===t&&(n=!!a.deleted)}),n},n.filterChange=function(e){return function(t){var n={},r=e.filter&&"function"==typeof e.filter;if(n.query=e.query_params,e.filter&&r&&!e.filter.call(this,t.doc,n))return!1;if(e.doc_ids&&-1===e.doc_ids.indexOf(t.id))return!1;if(e.include_docs)for(var o in t.doc._attachments)t.doc._attachments.hasOwnProperty(o)&&(t.doc._attachments[o].stub=!0);else delete t.doc;return!0}},n.processChanges=function(e,t,r){t=t.filter(n.filterChange(e)),e.limit&&e.limit<t.length&&(t.length=e.limit),t.forEach(function(t){n.call(e.onChange,t)}),e.continuous||n.call(e.complete,null,{results:t,last_seq:r})},n.parseDoc=function(e,t){var r,o,i,a=null,s={status:"available"};if(e._deleted&&(s.deleted=!0),t)if(e._id||(e._id=n.uuid()),o=n.uuid({length:32,radix:16}).toLowerCase(),e._rev){if(i=/^(\d+)-(.+)$/.exec(e._rev),!i)throw"invalid value for property '_rev'";e._rev_tree=[{pos:parseInt(i[1],10),ids:[i[2],{status:"missing"},[[o,s,[]]]]}],r=parseInt(i[1],10)+1}else e._rev_tree=[{pos:1,ids:[o,s,[]]}],r=1;else if(e._revisions&&(e._rev_tree=[{pos:e._revisions.start-e._revisions.ids.length+1,ids:e._revisions.ids.reduce(function(e,t){return null===e?[t,s,[]]:[t,{status:"missing"},[e]]},null)}],r=e._revisions.start,o=e._revisions.ids[0]),!e._rev_tree){if(i=/^(\d+)-(.+)$/.exec(e._rev),!i)return u.BAD_ARG;r=parseInt(i[1],10),o=i[2],e._rev_tree=[{pos:parseInt(i[1],10),ids:[i[2],s,[]]}]}"string"!=typeof e._id?a=u.INVALID_ID:n.isValidId(e._id)||(a=u.RESERVED_ID);for(var c in e)e.hasOwnProperty(c)&&"_"===c[0]&&-1===d.indexOf(c)&&(a=n.extend({},u.DOC_VALIDATION),a.reason+=": "+c);return e._id=decodeURIComponent(e._id),e._rev=[r,o].join("-"),a?a:Object.keys(e).reduce(function(t,n){return/^_/.test(n)&&"_attachments"!==n?t.metadata[n.slice(1)]=e[n]:t.data[n]=e[n],t},{metadata:{},data:{}})},n.isCordova=function(){return"undefined"!=typeof cordova||"undefined"!=typeof PhoneGap||"undefined"!=typeof phonegap},n.Changes=function(){var e={},t={};return o()?chrome.storage.onChanged.addListener(function(t){null!=t.db_name&&e.notify(t.db_name.newValue)}):"undefined"!=typeof window&&r.addEventListener("storage",function(t){e.notify(t.key)}),e.addListener=function(e,n,r,o){t[e]||(t[e]={}),t[e][n]={db:r,opts:o}},e.removeListener=function(e,n){t[e]&&delete t[e][n]},e.clearListeners=function(e){delete t[e]},e.notifyLocalWindows=function(e){o()?chrome.storage.local.set({db_name:e}):r.localStorage&&(localStorage[e]="a"===localStorage[e]?"b":"a")},e.notify=function(e){t[e]&&Object.keys(t[e]).forEach(function(r){var o=t[e][r].opts;t[e][r].db.changes({include_docs:o.include_docs,conflicts:o.conflicts,continuous:!1,descending:!1,filter:o.filter,view:o.view,since:o.since,query_params:o.query_params,onChange:function(e){e.seq>o.since&&!o.cancelled&&(o.since=e.seq,n.call(o.onChange,e))}})})},e},n.atob=t.browser&&"atob"in r?function(e){return atob(e)}:function(e){var t=new s(e,"base64");if(t.toString("base64")!==e)throw"Cannot base64 encode full string";return t.toString("binary")},n.btoa=t.browser&&"btoa"in r?function(e){return btoa(e)}:function(e){return new s(e,"binary").toString("base64")},n.fixBinary=function(e){if(!t.browser)return e;for(var n=e.length,r=new ArrayBuffer(n),o=new Uint8Array(r),i=0;n>i;i++)o[i]=e.charCodeAt(i);return r},n.toPromise=function(e){return function(){var t=this,n=Array.prototype.slice.call(arguments),r="function"==typeof n[n.length-1]?n.pop():!1,o=new c(function(r,o){function i(e,t){e?o(e):r(t)}n.push(i),e.apply(t,n)});return r&&o.then(function(e){r(null,e)},r),o}}}).call(this,e("/Users/philipp.reinking/workspace/pouch_fix/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./deps/ajax":6,"./deps/blob":7,"./deps/buffer":19,"./deps/errors":8,"./deps/extend":10,"./deps/md5.js":11,"./deps/uuid":12,"./merge":14,"/Users/philipp.reinking/workspace/pouch_fix/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":20,bluebird:21}],18:[function(e,t){t.exports=e("../package.json").version},{"../package.json":33}],19:[function(){},{}],20:[function(e,t){var n=t.exports={};n.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){var r=n.shift();r()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.binding=function(){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(){throw new Error("process.chdir is not supported")}},{}],21:[function(e,t){"use strict";function n(e,t,n){u?Object.defineProperty(e,t,{value:n,configurable:!0,writable:!0}):e[t]=n}function r(e){return this instanceof r?(n(this,"successQueue",[]),n(this,"failureQueue",[]),n(this,"resolved",!1),void("function"==typeof e&&this.resolvePassed(e))):new r(e)}function o(e,t,n){n&&"function"==typeof n.then?n.then(e,t):e(n)}function i(e,t,n){function o(){var o=arguments[n];return"function"!=typeof o?e:new r(function(e,n){s(a,o,t,e,n)})}return o}function a(e,t,n,r){try{o(n,r,e(t))}catch(i){r(i)}}var s=e("immediate"),u=!1;!function(){try{Object.defineProperty({},"test",{value:!0}),u=!0}catch(e){}}(),n(r.prototype,"resolvePassed",function(e){try{e(this.fulfillUnwrap.bind(this),this.reject.bind(this))}catch(t){this.reject(t)}}),n(r.prototype,"reject",function(e){this.resolve(!1,e)}),n(r.prototype,"fulfill",function(e){this.resolve(!0,e)}),n(r.prototype,"fulfillUnwrap",function(e){o(this.fulfill.bind(this),this.reject.bind(this),e)}),r.prototype.then=function(e,t){return this.resolved?this.resolved(e,t):this.pending(e,t)},function(){try{r.prototype.catch=function(e){return this.then(null,e)}}catch(e){}}(),n(r.prototype,"pending",function(e,t){var n=this;return new r(function(r,o){n.successQueue.push("function"==typeof e?{resolve:r,reject:o,callback:e}:{next:r,callback:!1}),n.failureQueue.push("function"==typeof t?{resolve:r,reject:o,callback:t}:{next:o,callback:!1})})}),n(r.prototype,"resolve",function(e,t){if(!this.resolved){this.resolved=i(this,t,e?0:1);for(var n=e?this.successQueue:this.failureQueue,r=n.length,o=-1;++o<r;)n[o].callback?s(a,n[o].callback,t,n[o].resolve,n[o].reject):n[o].next(t)}}),t.exports=r},{immediate:24}],22:[function(e,t,n){"use strict";n.test=function(){return!1}},{}],23:[function(e,t){(function(e){t.exports="object"==typeof e&&e?e:this}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],24:[function(e,t){"use strict";function n(){var e,t=0,n=i;for(i=[];e=n[t++];)e()}for(var r,o=[e("./nextTick"),e("./mutation"),e("./realSetImmediate"),e("./postMessage"),e("./messageChannel"),e("./stateChange"),e("./timeout")],i=[],a=-1,s=o.length;++a<s;)if(o[a].test()){r=o[a].install(n);break}var u=function(e){var t,o,a=e;return arguments.length>1&&"function"==typeof e&&(o=Array.prototype.slice.call(arguments,1),a=function(){e.apply(void 0,o)}),1===(t=i.push(a))&&r(n),t};u.clear=function(e){return e<=i.length&&(i[e-1]=function(){}),this},t.exports=u},{"./messageChannel":25,"./mutation":26,"./nextTick":22,"./postMessage":27,"./realSetImmediate":28,"./stateChange":29,"./timeout":30}],25:[function(e,t,n){"use strict";var r=e("./global");n.test=function(){return!!r.MessageChannel},n.install=function(e){var t=new r.MessageChannel;return t.port1.onmessage=e,function(){t.port2.postMessage(0)}}},{"./global":23}],26:[function(e,t,n){"use strict";var r=e("./global"),o=r.MutationObserver||r.WebKitMutationObserver;n.test=function(){return o},n.install=function(e){var t=new o(e),n=r.document.createElement("div");return t.observe(n,{attributes:!0}),r.addEventListener("unload",function(){t.disconnect(),t=null},!1),function(){n.setAttribute("drainQueue","drainQueue")}}},{"./global":23}],27:[function(e,t,n){"use strict";var r=e("./global");n.test=function(){if(!r.postMessage||r.importScripts)return!1;var e=!0,t=r.onmessage;return r.onmessage=function(){e=!1},r.postMessage("","*"),r.onmessage=t,e},n.install=function(e){function t(t){t.source===r&&t.data===n&&e()}var n="com.calvinmetcalf.setImmediate"+Math.random();return r.addEventListener?r.addEventListener("message",t,!1):r.attachEvent("onmessage",t),function(){r.postMessage(n,"*")}}},{"./global":23}],28:[function(e,t,n){"use strict";var r=e("./global");n.test=function(){return r.setImmediate},n.install=function(e){return r.setTimeout.bind(r,e,0)}},{"./global":23}],29:[function(e,t,n){"use strict";var r=e("./global");n.test=function(){return"document"in r&&"onreadystatechange"in r.document.createElement("script")},n.install=function(e){return function(){var t=r.document.createElement("script");return t.onreadystatechange=function(){e(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},r.document.documentElement.appendChild(t),e}}},{"./global":23}],30:[function(e,t,n){"use strict";n.test=function(){return!0},n.install=function(e){return function(){setTimeout(e,0)}}},{}],31:[function(_dereq_,module,exports){"use strict";function MapReduceError(e,t,n){this.name=e,this.message=t,this.status=n}function createKeysLookup(e){for(var t={},n=0,r=e.length;r>n;n++){var o=normalizeKey(e[n]),i=t[o];"undefined"==typeof i?t[o]=n:"number"==typeof i?t[o]=[i,n]:i.push(n)}return t}function sortByIdAndValue(e,t){var n=collate(e.id,t.id);return 0!==n?n:collate(e.value,t.value)}function addAtIndex(e,t,n){var r=n[e];"undefined"==typeof r?n[e]=t:Array.isArray(r)?r.push(t):n[e]=[r,t]}function sum(e){return e.reduce(function(e,t){return e+t},0)}function addHttpParam(e,t,n,r){var o=t[e];"undefined"!=typeof o&&(r&&(o=encodeURIComponent(JSON.stringify(o))),n.push(e+"="+o))}function MapReduce(db){function mapUsingKeys(e,t,n){var r=new Array(t.length);e.forEach(function(e){var t=n[normalizeKey(e.key)];"number"==typeof t?addAtIndex(t,e,r):t.forEach(function(t){addAtIndex(t,e,r)})});var o=[];return r.forEach(function(e){Array.isArray(e)?o=o.concat(e.sort(sortByIdAndValue)):o.push(e)}),o}function viewQuery(fun,options){function emit(e,t){var n={id:current.doc._id,key:e,value:t};if(!("undefined"!=typeof options.startkey&&collate(e,options.startkey)<0||"undefined"!=typeof options.endkey&&collate(e,options.endkey)>0||"undefined"!=typeof options.key&&0!==collate(e,options.key)||"undefined"!=typeof options.keys&&(keysLookup=keysLookup||createKeysLookup(options.keys),"undefined"==typeof keysLookup[normalizeKey(e)]))){if(num_started++,options.include_docs){if(t&&"object"==typeof t&&t._id)return void db.get(t._id,function(e,t){t&&(n.doc=t),results.push(n),checkComplete()});n.doc=current.doc}results.push(n)}}function checkComplete(){var e;if(completed&&results.length===num_started){if("undefined"!=typeof options.keys&&results.length?results=mapUsingKeys(results,options.keys,keysLookup):results.sort(function(e,t){var n=collate(e.key,t.key);return 0!==n?n:collate(e.id,t.id)}),options.descending&&results.reverse(),options.reduce===!1)return options.complete(null,{total_rows:results.length,offset:options.skip,rows:"limit"in options?results.slice(options.skip,options.limit+options.skip):options.skip>0?results.slice(options.skip):results});var t=[];if(results.forEach(function(e){var n=t[t.length-1];return n&&0===collate(n.key[0][0],e.key)?(n.key.push([e.key,e.id]),void n.value.push(e.value)):void t.push({key:[[e.key,e.id]],value:[e.value]})}),t.forEach(function(t){return t.value=fun.reduce(t.key,t.value),t.value.sumsqr&&t.value.sumsqr instanceof MapReduceError?void(e=t.value):void(t.key=t.key[0][0])}),e)return void options.complete(e);options.complete(null,{total_rows:t.length,offset:options.skip,rows:"limit"in options?t.slice(options.skip,options.limit+options.skip):options.skip>0?t.slice(options.skip):t})}}options.skip||(options.skip=0),fun.reduce||(options.reduce=!1);var results=[],current,num_started=0,completed=!1,keysLookup;eval("fun.map = "+fun.map.toString()+";"),fun.reduce&&(builtInReduce[fun.reduce]?fun.reduce=builtInReduce[fun.reduce]:eval("fun.reduce = "+fun.reduce.toString()+";")),db.changes({conflicts:!0,include_docs:!0,onChange:function(e){"deleted"in e||"_"===e.id[0]||(current={doc:e.doc},fun.map.call(this,e.doc))},complete:function(){completed=!0,checkComplete()}})}function httpQuery(e,t){var n,r=t.complete,o=[],i="GET";if(addHttpParam("reduce",t,o),addHttpParam("include_docs",t,o),addHttpParam("limit",t,o),addHttpParam("descending",t,o),addHttpParam("group",t,o),addHttpParam("group_level",t,o),addHttpParam("skip",t,o),addHttpParam("startkey",t,o,!0),addHttpParam("endkey",t,o,!0),addHttpParam("key",t,o,!0),"undefined"!=typeof t.keys&&(i="POST","string"==typeof e?n=JSON.stringify({keys:t.keys}):e.keys=t.keys),o=o.join("&"),o=""===o?"":"?"+o,"string"==typeof e){var a=e.split("/");return void db.request({method:i,url:"_design/"+a[0]+"/_view/"+a[1]+o,body:n},r)}var s=JSON.parse(JSON.stringify(e,function(e,t){return"function"==typeof t?t+"":t}));db.request({method:"POST",url:"_temp_view"+o,body:s},r)}return this instanceof MapReduce?void(this.query=function(e,t,n){"function"==typeof t&&(n=t,t={}),n&&(t.complete=n);var r=t.complete,o=new Promise(function(n,r){if(t.complete=function(e,t){e?r(e):n(t)},"http"===db.type())return"function"==typeof e?httpQuery({map:e},t):httpQuery(e,t);if("object"==typeof e)return viewQuery(e,t);if("function"==typeof e)return viewQuery({map:e},t);var o=e.split("/");db.get("_design/"+o[0],function(e,n){return e?void t.complete(e):n.views[o[1]]?void viewQuery({map:n.views[o[1]].map,reduce:n.views[o[1]].reduce},t):void t.complete({name:"not_found",message:"missing_named_view"})})});return r&&o.then(function(e){r(null,e)},r),o}):new MapReduce(db)}var pouchCollate=_dereq_("pouchdb-collate"),Promise=_dereq_("lie"),collate=pouchCollate.collate,normalizeKey=pouchCollate.normalizeKey;MapReduceError.prototype=new Error;var builtInReduce={_sum:function(e,t){return sum(t)},_count:function(e,t){return t.length},_stats:function(e,t){return{sum:sum(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:function(){var e=0;for(var n in t){if("number"!=typeof t[n])return new MapReduceError("builtin _stats function requires map values to be numbers","invalid_value",500);e+=t[n]*t[n]}return e}()}}};MapReduce._delete=function(){},module.exports=MapReduce},{lie:21,"pouchdb-collate":32}],32:[function(e,t,n){"use strict";function r(e,t){for(var r=Math.min(e.length,t.length),o=0;r>o;o++){var i=n.collate(e[o],t[o]);if(0!==i)return i}return e.length===t.length?0:e.length>t.length?1:-1}function o(e,t){return e===t?0:e>t?1:-1}function i(e,t){for(var r=Object.keys(e),o=Object.keys(t),i=Math.min(r.length,o.length),a=0;i>a;a++){var s=n.collate(r[a],o[a]);if(0!==s)return s;if(s=n.collate(e[r[a]],t[o[a]]),0!==s)return s}return r.length===o.length?0:r.length>o.length?1:-1}function a(e){var t=["boolean","number","string","object"];return-1!==t.indexOf(typeof e)?null===e?1:t.indexOf(typeof e)+2:Array.isArray(e)?4.5:void 0}n.collate=function(e,t){e=n.normalizeKey(e),t=n.normalizeKey(t);var s=a(e),u=a(t);return s-u!==0?s-u:null===e?0:"number"==typeof e?e-t:"boolean"==typeof e?e===t?0:t>e?-1:1:"string"==typeof e?o(e,t):Array.isArray(e)?r(e,t):"object"==typeof e?i(e,t):void 0},n.normalizeKey=function(e){if("undefined"==typeof e)return null;if("number"==typeof e){if(1/0===e||e===-1/0||isNaN(e))return null}else if(e instanceof Date)return e.toJSON();return e}},{}],33:[function(e,t){t.exports={name:"pouchdb",version:"1.2.0-alpha",description:"PouchDB is a pocket-sized database.",release:"nightly",main:"./lib/index.js",homepage:"https://github.com/daleharvey/pouchdb",repository:"https://github.com/daleharvey/pouchdb",keywords:["db","couchdb","pouchdb"],tags:["db","couchdb","pouchdb"],dependencies:{level:"~0.18.0",request:"~2.28.0","pouchdb-mapreduce":"0.5.0",bluebird:"~1.0.0"},devDependencies:{commander:"~2.1.0",watchify:"~0.4.1","uglify-js":"~2.4.6",jshint:"~2.3.0","http-proxy":"~0.10.3",corsproxy:"~0.2.13","http-server":"~0.5.5",browserify:"~3.24.13",lie:"~2.5.2",wd:"~0.2.8",tin:"~0.4.0","qunit-mocha-ui":"0.0.5",mocha:"~1.17.1",chai:"~1.9.0",istanbul:"~0.2.4"},scripts:{jshint:"./node_modules/.bin/jshint -c .jshintrc lib/*.js lib/adapters/*.js lib/deps/*.js","build-js":"mkdir -p dist && ./node_modules/.bin/browserify lib/index.js -s PouchDB -o dist/pouchdb-nightly.js","watch-js":"mkdir -p dist && ./node_modules/.bin/watchify lib/index.js -s PouchDB -o dist/pouchdb-nightly.js",uglify:"./node_modules/.bin/uglifyjs dist/pouchdb-nightly.js -mc > dist/pouchdb-nightly.min.js",build:"npm run build-js && npm run uglify","test-node":"./bin/run-mocha.sh","test-browser":"npm run build-js && ./bin/test-browser.js","dev-server":"./bin/dev-server.js",test:"npm run jshint && npm run test-node && npm run test-browser",publish:"./bin/publish.sh","publish-site":"./bin/publish-site.sh",coverage:"COVERAGE=1 ./bin/run-mocha.sh"},browser:{"./adapters/leveldb":!1,"./deps/buffer":!1,request:!1,level:!1,path:!1,fs:!1,events:!1,crypto:!1,bluebird:"lie"}}},{}]},{},[13])(13)});