app.controller("PostingController",["$scope","$routeParams","$rootScope",function(e,t,o){function n(){return current_date=new Date,current_day_hours=current_date.getHours(),current_day_minutes=current_date.getMinutes(),60*current_day_hours*60+60*current_day_minutes}function i(){stickyActionBar()}var s=Math.floor(1e3*Math.random()),c="PostingController"+s;o.activeController="PostingController"+s;var d=new Object;o.postingPossible=!0,e.global_functions=e.global_functions?e.global_functions:{},e.posting={},e.posting_functions={},e.postings=new Array,e.comment={},e.comment_functions={},e.comments={},e.like={},e.like_functions={},e.likes={},e.types={},e.apply=function(){e.$$phase||e.$apply()},e.db.info(function(t,n){d[s]=e.db.changes({continuous:!0,include_docs:!0,since:n.update_seq,onChange:function(t){if(c!=o.activeController)return d[s].cancel(),void 0;switch(e.types[t.id]&&e.types[t.id].type&&!t.doc.type&&(t.doc.type=e.types[t.id].type),t.doc.type){case"POST":e.posting_functions.onChange(t);break;case"LIKE":e.like_functions.onChange(t);break;case"COMMENT":e.comment_functions.onChange(t)}},complete:function(){}})}),e.posting.hashtag=t.hashtag?"#"+t.hashtag.toUpperCase():"#",e.posting_functions.onChange=function(t){t.deleted?angular.forEach(e.postings,function(o,n){o.id==t.id&&e.postings.splice(n,1)}):e.types[t.id]||t.doc.image&&!t.doc._attachments||(t.doc.image&&t.doc._attachments?(e.types[t.id]={type:"POST"},e.likes[t.id]=new Array,t.doc.user.id==e.user.getId()&&e.images[t.id]&&(t.temp_img=e.images[t.id]),e.postings.push(t)):(e.types[t.id]={type:"POST"},e.likes[t.id]=new Array,e.postings.push(t))),e.apply()},e.posting_functions.delete=function(t){var o=window.confirm("Do you really want to delete this post?");o&&e.db.get(t.id,function(t,o){o.msg="",delete o.msg_formatted,e.db.put(o,function(t,o){delete o.ok;var n=o.id;o._id=o.id,delete o.id,o._rev=o.rev,delete o.rev,e.db.remove(o,function(t,o){pusher=new Array,pusher.push(o.id),angular.forEach(e.likes[n],function(t){e.like_functions.delete(t,0),pusher.push(t.id)}),angular.forEach(e.comments[n],function(t){e.comment_functions.delete(t,0),pusher.push(o.id)}),e.global_functions.toPush(pusher)})})})},e.posting_functions.isPost=function(e){"POST"==e.type&&emit([e._id,0],e),"LIKE"==e.type&&emit([e.posting,1],e),"COMMENT"==e.type&&emit([e.posting,2],e)},e.time=function(e){return e/=1e3},e.posting_functions.showTimestamp=function(e){return maxTimeDifferenceForToday=Math.round((new Date).getTime()/1e3)-n(),maxTimeDifferenceForYesterday=maxTimeDifferenceForToday-86400,postTime=e.doc.created/1e3,postTime>maxTimeDifferenceForYesterday&&maxTimeDifferenceForToday>postTime?"yesterday":maxTimeDifferenceForToday>postTime?"older":"today"},e.global_functions.showLoader=function(){return e.postings.length>=1?!1:!0},e.global_functions.orderByCreated=function(e){return e.created?e.created:e.doc.created},e.global_functions.isDeletable=function(t){return t.doc.user.id==e.user.getId()?!0:!1},e.global_functions.showWall=function(){e.db.query({map:e.posting_functions.isPost},{reduce:!0},function(t,o){e.postings=[],e.likes={},e.comments={},e.types={},e.response=o,angular.forEach(o.rows,function(t){if(t.value&&(t.doc=t.value,delete t.value),t.doc.created)switch(t.doc.type){case"POST":e.types[t.id]={type:"POST"},e.postings.push(t),e.likes[t.id]||(e.likes[t.id]=new Array),e.comments[t.id]||(e.comments[t.id]=new Array);break;case"LIKE":if(e.types[t.id]||(e.types[t.id]=new Array),e.types[t.id]={type:"LIKE",posting:t.doc.posting},!e.likes[t.doc.posting])break;e.likes[t.doc.posting].push(t);break;case"COMMENT":if(e.types[t.id]||(e.types[t.id]=new Array),e.types[t.id]={type:"COMMENT",posting:t.doc.posting},!e.comments[t.doc.posting])break;e.comments[t.doc.posting].push(t)}e.apply()})})},i(),e.image_functions={},e.like_functions.create=function(t){var o=0;if(e.likes[t.id]&&angular.forEach(e.likes[t.id],function(t){t.doc.user.id==e.user.getId()&&(o=1)}),!o){doc={created:(new Date).getTime(),posting:t.id,user:{id:e.user.getId(),name:e.user.getName()},coords:{longitude:e.coords.longitude,latitude:e.coords.latitude,accuracy:e.coords.accuracy},type:"LIKE"};var n={};n.doc=doc,e.like_functions.createToScope(n),e.db.post(doc,function(t,o){e.global_functions.toPush(o)})}},e.like_functions.createToScope=function(t){e.types[t.id]={type:"LIKE",posting:t.doc.posting},e.likes[t.doc.posting]||(e.likes[t.doc.posting]=new Array),e.likes[t.doc.posting].push(t),e.apply()},e.like_functions.delete=function(t,o){o="undefined"!=typeof o?o:1,e.db.get(t.id,function(t,n){e.db.remove(n,function(t,n){o&&e.global_functions.toPush(n)}),o&&e.like_functions.deleteFromScope(n._id)})},e.like_functions.deleteFromScope=function(t){e.types[t]&&angular.forEach(e.likes[e.types[t].posting],function(o,n){o.id==t&&(e.likes[e.types[t].posting].splice(n,1),e.apply())})},e.like_functions.onChange=function(t){t.deleted?e.likes[e.types[t.id].posting]&&e.like_functions.deleteFromScope(t.id):(e.likes[t.doc.posting]&&angular.forEach(e.likes[t.doc.posting],function(o){t.doc.user.id==e.user.getId()&&e.like_functions.deleteFromScope(o._id)}),e.like_functions.createToScope(t))},e.comment_functions.newComment=function(e,t){if(e){var o="#post-"+t,n="#comment_"+t,i=$(".snap-content").scrollTop(),s=$(o).offset().top,c=i+s;$(".snap-content").animate({scrollTop:c},300),setTimeout(function(){$(n).focus()},1)}},e.comment_functions.showComments=function(t){return e.comments[t]?!0:!1},e.comment_functions.create=function(t){var o=document.getElementById("comment_"+t.id).value;return!o.length>=1?!1:(doc={created:(new Date).getTime(),posting:t.id,msg:o,user:{id:e.user.getId(),name:e.user.getName()},coords:{longitude:e.coords.longitude,latitude:e.coords.latitude,accuracy:e.coords.accuracy},type:"COMMENT"},e.db.post(doc,function(t,o){e.global_functions.toPush(o)}),document.getElementById("comment_"+t.id).value="",void 0)},e.comment_functions.delete=function(t,o){o="undefined"!=typeof o?o:1,o&&e.comment_functions.deleteFromScope(t.id),e.db.get(t.id,function(t,n){e.db.remove(n,function(t,n){o&&e.global_functions.toPush(n)})})},e.comment_functions.deleteFromScope=function(t){angular.forEach(e.comments[e.types[t].posting],function(o,n){o.id==t&&(e.comments[e.types[t].posting].splice(n,1),e.apply())})},e.comment_functions.onChange=function(t){t.deleted?e.comment_functions.deleteFromScope(t.id):(e.types[t.id]={type:"COMMENT",posting:t.doc.posting},e.comments[t.doc.posting]||(e.comments[t.doc.posting]=new Array),e.comments[t.doc.posting].push(t),e.apply())},e.report_functions={},e.report_functions.report=function(t){doc={created:(new Date).getTime(),posting:t.id,user:{id:e.user.getId(),name:e.user.getName()},type:"REPORT"},e.db.post(doc,function(t,o){e.global_functions.toPush(o)})},e.apply()}]);